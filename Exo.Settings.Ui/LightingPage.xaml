<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Exo.Settings.Ui.LightingPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:CommunityToolkit.WinUI.UI.Controls"
    xmlns:local="using:Exo.Settings.Ui"
    xmlns:vm="using:Exo.Settings.Ui.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    d:DataContext="{d:DesignInstance vm:LightingViewModel, IsDesignTimeCreatable=False}">

    <Page.Resources>
        <DataTemplate x:Key="ColorPropertyTemplate" x:DataType="vm:PropertyViewModel">
            <controls:ColorPickerButton SelectedColor="{Binding Value, Mode=TwoWay}">
                <controls:ColorPickerButton.ColorPickerStyle>
                    <Style TargetType="controls:ColorPicker">
                        <Setter Property="ColorSpectrumShape" Value="Ring" />
                    </Style>
                </controls:ColorPickerButton.ColorPickerStyle>
            </controls:ColorPickerButton>
        </DataTemplate>
        <DataTemplate x:Key="NumericRangePropertyTemplate" x:DataType="vm:PropertyViewModel">
            <Slider Minimum="{Binding MinimumValue, Mode=OneTime}" Maximum="{Binding MaximumValue, Mode=OneTime}" Value="{Binding Value, Mode=TwoWay}" HorizontalContentAlignment="Stretch" HorizontalAlignment="Stretch" />
        </DataTemplate>
        <DataTemplate x:Key="NumericPropertyTemplate" x:DataType="vm:PropertyViewModel">
            <NumberBox Value="{Binding Value, Mode=TwoWay}" />
        </DataTemplate>
        <DataTemplate x:Key="EnumPropertyTemplate" x:DataType="vm:PropertyViewModel">
            <ComboBox SelectedValuePath="Value" SelectedValue="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" ItemsSource="{Binding EnumerationValues, Mode=OneTime}" HorizontalAlignment="Stretch">
                <ComboBox.ItemTemplate>
                    <DataTemplate>
                        <TextBlock Text="{Binding DisplayName}" />
                    </DataTemplate>
                </ComboBox.ItemTemplate>
            </ComboBox>
        </DataTemplate>
        <DataTemplate x:Key="EnumRangePropertyTemplate" x:DataType="vm:PropertyViewModel">
            <Slider SnapsTo="StepValues" TickFrequency="1" Minimum="{Binding MinimumValue, Mode=OneTime}" Maximum="{Binding MaximumValue, Mode=OneTime}" Value="{Binding Value, Mode=TwoWay}" HorizontalContentAlignment="Stretch" HorizontalAlignment="Stretch">
                <Slider.ThumbToolTipValueConverter>
                    <local:EnumerationValueToNameConverter Values="{Binding EnumerationValues, Mode=OneTime}" />
                </Slider.ThumbToolTipValueConverter>
            </Slider>
        </DataTemplate>
        <DataTemplate x:Key="FallbackPropertyTemplate">
        </DataTemplate>
        <local:EffectPropertyTemplateSelector
            x:Key="EffectPropertyTemplateSelector"
            NumericRangeTemplate="{StaticResource NumericRangePropertyTemplate}"
            NumericTemplate="{StaticResource NumericPropertyTemplate}"
            ColorTemplate="{StaticResource ColorPropertyTemplate}"
            EnumTemplate="{StaticResource EnumPropertyTemplate}"
            EnumRangeTemplate="{StaticResource EnumRangePropertyTemplate}"
            FallbackTemplate="{StaticResource FallbackPropertyTemplate}" />
    </Page.Resources>

    <ScrollViewer Padding="{StaticResource PageDefaultPadding}" HorizontalContentAlignment="Stretch">
        <ItemsControl ItemsSource="{Binding LightingDevices}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
            <ItemsControl.ItemTemplate>
                <DataTemplate>
                    <Expander Margin="0,0,0,24" IsEnabled="{Binding IsNotBusy}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                        <Expander.Header>
                            <StackPanel Orientation="Horizontal">
                                <FontIcon Glyph="{Binding Category, Converter={StaticResource DeviceCategoryToGlyphConverter}}" />
                                <TextBlock Text="{Binding FriendlyName, Mode=OneTime}" Margin="12,0,0,0" />
                            </StackPanel>
                        </Expander.Header>
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Stretch">
                            <ItemsControl ItemsSource="{Binding LightingZones}" HorizontalContentAlignment="Stretch">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Expander Margin="0,12,0,12" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch">
                                            <Expander.Header>
                                                <StackPanel Orientation="Horizontal">
                                                    <FontIcon Glyph="&#xE950;" />
                                                    <TextBlock Text="{Binding Name, Mode=OneTime}" Margin="12,0,0,0" />
                                                    <Border Margin="12,0,0,0" Width="20" Height="20" Visibility="{Binding Color, Converter={StaticResource NullabilityToVisibilityConverter}}" BorderBrush="{ThemeResource ControlStrokeColorSecondaryBrush}" BorderThickness="1">
                                                        <Border.Background>
                                                            <SolidColorBrush Color="{Binding Color, Mode=OneWay}" />
                                                        </Border.Background>
                                                    </Border>
                                                </StackPanel>
                                            </Expander.Header>
                                            <StackPanel Orientation="Vertical">
                                                <Grid HorizontalAlignment="Stretch">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="200" />
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="Auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <TextBlock Grid.Column="0" VerticalAlignment="Center" Margin="0,6,0,6" Text="Effect" />
                                                    <ComboBox Grid.Column="1" Margin="6,6,6,6" ItemsSource="{Binding SupportedEffects}" SelectedValue="{Binding CurrentEffect, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch">
                                                        <ComboBox.ItemTemplate>
                                                            <DataTemplate>
                                                                <TextBlock Text="{Binding DisplayName}" />
                                                            </DataTemplate>
                                                        </ComboBox.ItemTemplate>
                                                    </ComboBox>
                                                    <Button Grid.Column="2" Margin="6,0,6,0" HorizontalAlignment="Right" IsEnabled="{Binding IsModified, Mode=OneWay}">
                                                        <FontIcon Glyph="&#xE777;" />
                                                    </Button>
                                                </Grid>
                                                <ItemsControl ItemsSource="{Binding Properties}">
                                                    <ItemsControl.ItemTemplate>
                                                        <DataTemplate>
                                                            <Grid Margin="0,6,0,6" HorizontalAlignment="Stretch">
                                                                <Grid.ColumnDefinitions>
                                                                    <ColumnDefinition Width="200" />
                                                                    <ColumnDefinition Width="*" />
                                                                    <ColumnDefinition Width="Auto" />
                                                                </Grid.ColumnDefinitions>
                                                                <TextBlock Grid.Column="0" VerticalAlignment="Center" Margin="0,6,0,6" Text="{Binding DisplayName}" />
                                                                <ContentControl Grid.Column="1" VerticalAlignment="Center" Margin="6,0,6,0" Content="{Binding Mode=OneWay}" HorizontalAlignment="Stretch" HorizontalContentAlignment="Stretch" ContentTemplateSelector="{StaticResource EffectPropertyTemplateSelector}" />
                                                                <Button Grid.Column="2" Margin="6,0,6,0" IsEnabled="{Binding IsModified, Mode=OneWay}" Click="OnPropertyResetButtonClick">
                                                                    <FontIcon Glyph="&#xE777;" />
                                                                </Button>
                                                            </Grid>
                                                        </DataTemplate>
                                                    </ItemsControl.ItemTemplate>
                                                </ItemsControl>
                                            </StackPanel>
                                        </Expander>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <StackPanel Orientation="Horizontal" Margin="0,12,0,12" HorizontalAlignment="Right">
                                <Button HorizontalAlignment="Right" Content="Reset" Margin="0,0,6,0" IsEnabled="{Binding IsModified, Mode=OneWay}" />
                                <Button Content="Apply" Style="{StaticResource AccentButtonStyle}" IsEnabled="{Binding IsModified, Mode=OneWay}" HorizontalAlignment="Right" Margin="6,0,0,0" Click="OnApplyButtonClick" />
                            </StackPanel>
                        </StackPanel>
                    </Expander>
                </DataTemplate>
            </ItemsControl.ItemTemplate>
        </ItemsControl>
    </ScrollViewer>
</Page>
