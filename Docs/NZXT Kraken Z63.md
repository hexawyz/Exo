# NZXT Kraken Z63

This device is a composite device that has both a "vendor-specific" endpoint accessed by CAM through WinUsb for some reason, and a more regular "HID" endpoint, also relying on a fully custom protocol.
The reasons behind this are unclear yet, and naive observations only show data exchanged over the HID endpoint.

By trying to change the images in CAM, we can see that the other (WinUSB) device interface is used to transmit some data packets, including entire gif images, or what seems to be raw RGBA data.
As such, the reason for the choice of a separate interface might have been tor that exact reason, as the image data can be quite long and of variable size.

## Quick analysis using Wireshark

HID protocol is always 64 bytes long, including the report descriptor.
However, as is relatively unusual, commands are split in their own reports, meaning that the report ID byte is not "wasted".

It seems that commands go by pair, with input reports having the bit 0 set, and output/feature reports having the bit 0 unset.
This can be observed by the 74 / 75 (request/response) pair used by NZXT CAM. However, it does not seem to always be the case.

### Format of responses

There seem to be two kinds of commands: Commands that have a dedicated response, and commands who don't.

In both cases, the format is similar:

````
<CommandId> <SubId> 1a 00 41 00 0a "Q840512" <Result> <Zero Padding>
````

Commands with a dedicated response seem to return a result, while other seem to just return some kind of `ACK`.
However, most commands with a dedicated response simply return the value `01`, which I'm assuming indicates success.

In the case of a dedicated response, the command id for the response is `CommandId OR 0x01`, and the result data depends on the command.

In the case of a generic ack response, the command id is always `FF`, and the sub-id is always `01` (?). The result data in that case contain two bytes identifying the original command id and sub-id.

NB: Meaning of other fields in the response is unclear/unknown.

### Status

````
REQ: 74 01 00 â€¦
RES: 75 01 1a 00 41 00 0a 51383430353132 01 1f 09 ff 06 23 23 01 00 af 03 19 19 00 00 â€¦
````

This seems to contain information about the device, periodically requested by CAM.
It contains the string "Q840512" that we also observe in `FF` messages.
Other values are changing, and among them we can see `ff 06` and `af 03`, which I'm pretty certain are the pump speed and the fan speed.
The numbers here, and across various occurrences, are similar in value to the ones displayed in NZXT CAM. (To be interpreted in little endian, i.e. `06ff` and `03af`)

The values `23 23` and `19 19` also vary in messages, always in pairs. => See below, duplication unexplained, but requested pump and fan speed %.

The value `1f` above would likely be the liquid temperature in Â°C, as it varies between 31 and 32Â°, which matches the observed messages.

The value `09` is yet unknown.

### Set pump/fan speed

We see the values `23` and `19` in the following requests:

````
72 02 01 01 19191919191919191919191919191919191919191919191919191919191919191919191919191919 0000000000000000000000000000000000000000
72 01 01 00 23232323232323232323232323232323232323232323232323232323232323232323232323232323 0000000000000000000000000000000000000000
````

The responses `FF` seem to be generated as a result of the `72` requests:

````
ff 01 1a 00 41 00 0a 51383430353132 72 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
ff 01 1a 00 41 00 0a 51383430353132 72 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

The response also contains the "Q840512" string (which might be some kind of model ID?)
Interestingly, we can see the request id `72` and what would be the subcommand id (`01` or `02` here) appearing here, probably acknowledging the request.

It is possible that the values sent here are the requested power of pump and fan in %.

â€¦ and indeed, these are the commands that are sent when the "fixed" mode is enabled (Fixed mode is Pump at 100% and fan at 40%)

````
72 01 01 00 646464646464646464646464646464646464646464646464646464646464646464646464646464640000000000000000000000000000000000000000
72 02 01 01 282828282828282828282828282828282828282828282828282828282828282828282828282828280000000000000000000000000000000000000000
````

As such, we can deduce that `01` is pump and `02` is fan. Following value unknown, and third value is `00` for pump and `01` for fan. (Meaning unknown yet)

### Set screen brightness (`30 02`)

Minimum value:

````
REQ: 30 02 01 00 00 00 00 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: ff 01 1a 00 41000a 51383430353132 30 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

Maximum value:

````
REQ: 30 02 01 64 00 00 00 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: ff 01 1a 00 41000a 51383430353132 30 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

This seems pretty straightforward. Brightness goes from 0 to 100.

NB: I observed another example of the `30 02` command when trying to rotate the screen:

````
REQ: 30 02 00 00 00 00 01 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

I only saw that one once, so I'm unsure what it could be, but I wonder if it indicates some kind of native rotation support.
However, the images seem to be software rotated, so I'm unsure about that.

### Change image (`38 01`)

This command will change the image displayed on the device.

````
REQ: 38 01 04 0d 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 39 01 1a 00 41000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

The command seems to take two parameters, the first one being always 4, and the second one being the stored image ID, from 0 to 15.

The first parameter being `04` indicates that the device should display one of the stored images.

Possible values are:

* `00` - Off
* `01` - Builtin animation (the same one that is displayed when the device boots after power down)
* `02` - Temperature (the graphics that are displayed by default when the computer boots and no controlling software has yet interacted with the device)
* `04` - Display specified image

### ??? Before and after a change of image to GIF

#### Before

On the HID interface:

````
REQ: 36 01 08 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 37 01 1a 0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

#### Image Upload

On the raw USB interface:

````
OUT: 12fa01e8abcdef9876543210010000008f820000
OUT: 47494638396140014001f6000000000000132d001c3d001e4100264fe8e9ed002954002c5a002d5bcccbd0002f5f003366b1b3bdaaadb79999998e8d908a8a8b â€¦
````

The first output might be some kind of "header" command to prepare the upload of the image.

#### After

On the HID interface:

````
REQ: 36 02 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 37 02 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````


### ??? Before and after a raw image frame

#### Before

On the HID interface:

````
REQ: 32 02 06 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 33 02 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
REQ: 32 02 06 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 33 02 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
REQ: 32 01 06 07 c012 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 33 01 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
REQ: 36 01 06 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 37 01 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

#### Image Upload

On the raw USB interface:

````
OUT: 12fa01e8abcdef98765432100200000000400600
OUT: 000000ff 000000ff 000000ff 000000ff 000000ff â€¦
````

The first command is slightly different from the one used for GIF, and it might indicate the format (that, or it is indicated in the previous commands)
The image data seems to represent a 320x320 surface in RGBA format, for a total of 409600 bytes. (Sent in a single packet)

(NB: 409600 is `64000` in hex; 102400 is `19000`.)

#### After

On the HID interface:

````
REQ: 36 02 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 37 02 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
REQ: 38 01 04 06 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
RES: 39 01 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

NB: After verifying other iterations, it seems the `06` in the commands `36 01` and `38` is correlated with the `06` in the command `32`. (i.e. it changes in other sequences)

### Samples of the `32` request

#### `32 01`

From Capture 1:

````
32 01 03 04 800c 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 04 05 100e 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 05 06 a00f 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0b 0c 3011 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 06 07 c012 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 07 08 0000 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

From Capture 2:

````
32 01 05 06 310e 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0b 0c c10f 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 06 07 5111 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 07 08 0000 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 09 0a 9001 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0a 0b 2003 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0c 0d b004 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 08 09 7017 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0e 0f 4006 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 00 01 f107 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0d 0e e112 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 01 02 7114 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0f 10 0019 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 02 03 8109 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 03 04 110b 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 04 05 a10c 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 05 06 310e 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0b 0c c10f 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 06 07 5111 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 07 08 0000 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 09 0a 9001 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0a 0b 2003 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0c 0d b004 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 08 09 0116 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0e 0f 4006 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 00 01 d007 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0d 0e e112 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 01 02 7114 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0f 10 9117 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 02 03 6009 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 03 04 f00a 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 04 05 800c 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 05 06 100e 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0b 0c a00f 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 06 07 3011 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 07 08 0000 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 09 0a 9001 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0a 0b 2003 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0c 0d b004 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 08 09 0116 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0e 0f 4006 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 00 01 d007 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0d 0e c012 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 01 02 5014 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 0f 10 9117 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 02 03 6009 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 03 04 f00a 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 01 04 05 800c 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

From Changing GIF images Capture:

````
32 01 08 09 e015 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (RAW)
32 01 0e 0f 4006 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (RAW)
32 01 00 01 d007 9001 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (RAW)
32 01 0d 0e 5111 5302 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (GIF)
32 01 01 02 2119 6c0d 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (GIF)
32 01 0f 10 8d26 e506 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (GIF)
32 01 02 03 722d b504 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (GIF)
32 01 03 04 2732 e603 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 (GIF)
````

By analyzing the above data, we can identify that the second parameter is always the value of the first parameter + 1.
First parameter is a value from `00` to `0f` , and second parameter is (as such) a value from `01` to `10`.

We can also identify the repeated value of `9001` which is 400 in little endian, as the N-1 (fourth?) parameter.
While it is constant (400) for raw images, it is, however, not, for GIF images.
As it seems, 400kB is exactly the size of a raw imageâ€¦
And if we look at the first GIF-related line here, we have the value 595, it matches with the GIF image having a size of 608637/1024 = 594.4kB.

The last parameter seems to always be `01`.

For raw images, the third parameter seems to be a value that is often incremented by 400 in the following batch (400 is the value of the next parameter: might be related)
At the beginning of capture 2, the value is an odd number (3633), but it resets to `0000` relatively quickly. However, there are still some "irregular" values in the sequence.

The values of parameters 1&2 do not seem to be correlated with the value of parameter 3:
While the same values are reused over different commands, we can see different pairs of values.

So, apparently, what it seems is that the device exposes its whole image memory space in a relatively weird way where the client app has to do the memory management.
The requests we see here would assign a specific memory region (in blocks of 1kB) to a given image ID, before uploading data to that region.

#### `32 02`

````
32 02 03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 02 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 02 05 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 02 0b 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 02 06 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
32 02 07 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

As seen before, the value here is reused in other commands. Parameter is a byte from `00` to `0f`.

### Samples of the `38` request

#### `38 01`

````
38 01 04 05 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 0b 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 06 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 07 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 09 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 0a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
38 01 04 0e 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

Not very useful as-is. The first parameter is always `04`, and the second parameter is the same as passed to other commands.

### Changing between GIF images

From NZXT CAM, we can change between multiple "recent" GIF images easily, which gave some interesting results.

It seems that GIF images are uploaded upon first change, which can take a long time. And very big images even seem to be cut into multiple raw packets. (so there is a limit ?)

But then, switching back to a previous image is almost instantaneous, which indicates that the device can remember multiple images.

The parameter used in the commands `32`, `36` and `38` is likely the image index.

### Samples of the pre-transfer packet on the raw USB interface

From changing GIF images capture:

````
12fa01e8 abcdef9876543210 02 000000 00400600 (RAW; Followed by 409600 bytes transfer)
12fa01e8 abcdef9876543210 01 000000 7d490900 (GIF; Followed by 608637 bytes transfer)
12fa01e8 abcdef9876543210 01 000000 0ead3500 (GIF; Followed by 2097152 bytes transfer; Followed by 1420558 bytes transfer; Total of 3517710 bytes transfer.)
12fa01e8 abcdef9876543210 01 000000 74931b00 (GIF; Followed by 1807220 bytes transfer)
12fa01e8 abcdef9876543210 01 000000 93d11200 (GIF; Followed by 1233299 bytes transfer)
12fa01e8 abcdef9876543210 01 000000 d7950f00 (GIF; Followed by 1021399 bytes transfer)
````

From the above examples (a single one of them is enough, though), we can deduce that the transfer length is encoded in the last 4 bytes, in little endian form.

Some other parameters are less clear, but we can at least identify the parameter indicating the image format, with `01` for GIF and `02` for RGBA. (Are there other supported formats ?)

The `abcdef9876543210` sequence seems oddly specific, so it is probably some kind of signature designated to tag these messages, e.g. in case of an interrupted transmission.

The other values, howeverâ€¦ No idea. They at least don't seem correlated with the image index.


### Upon CAM startup (`10 01`)

````
10 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
11 01 1a0041000a 51383430353132 083001050b 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

### Upon CAM startup (`36 03`)

````
36 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
37 03 1a0041000a 51383430353132 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

This might be some kind of initialization/reset sequenceâ€¦ ?

### Upon starting CAM (`30 01`)

````
30 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 01 1a0041000a 51383430353132 04005f00001040014001210100ff 000000000000000000000000000000000000000000000000000000000000000000000000
````

Upon starting the app after setting the brightness to the max value (100):

````
31 01 1a0041000a 51383430353132 04005f00001040014001640100ff 000000000000000000000000000000000000000000000000000000000000000000000000
````

Comparing the two values below will make the differences apparent:

````
OLD: 31 01 1a0041000a 51383430353132 04 005f 0000 10 4001 4001 21 0100ff 000000000000000000000000000000000000000000000000000000000000000000000000
NEW: 31 01 1a0041000a 51383430353132 04 005f 0000 10 4001 4001 64 0100ff 000000000000000000000000000000000000000000000000000000000000000000000000
````

So it appears that the currently set brightness is readable from this command, which may actually be useful :)

By delimiting that, it also makes some interesting numbers pop out, as the `4001` bytes map to the value 320 in little endian.
We can deduce that the command `30 01` is actually used to return (current) screen information, including width and height of the bitmap.
As such, I'm assuming that the number preceding those would indicate the number of available images?

From my understanding, `5f00` would be the last memory block that can be allocated, so it would be `005f` in little endian.
This would means that we have 24MB of memory available. Just to be safe, let's consider this as 23.75 for now, but 24 should be correct.
Sadly, this then does not explain the `04` byte before, as it can't be the block size (which would be `0004` in little endian)

### Upon starting CAM (`30 04`)

````
30 04 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 00 01 02 9801 5500 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 01 02 02 2119 6c0d 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 02 03 02 722d b504 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 03 04 02 2732 e603 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 04 05 02 6009 5200 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 05 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 05 06 02 2d0a e506 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 06 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 06 07 02 3011 2100 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 07 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 07 08 02 0000 5400 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 08 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 08 09 02 1b01 5600 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 09 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 09 0a 02 5400 5100 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0a 0b 02 a500 2300 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0b 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0b 0c 02 060a 2700 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0c 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0c 0d 02 c800 5300 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0d 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0d 0e 02 ed01 5200 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0e 0f 02 7101 2700 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0f 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0f 10 02 3f02 5302 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

This seems to be querying some information on the assigned images, as we see in responses the same "N" followed by "N+1" pattern as for `32 02` requests.

Another startup after CAM has been running the clock face for some time:

````
30 04 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 00 01 02 7017 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 01 02 02 e015 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 02 03 02 2003 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 03 04 02 b004 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 04 05 02 4006 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 05 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 05 06 02 d007 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 06 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 06 07 02 6009 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 07 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 07 08 02 f00a 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 08 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 08 09 02 800c 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 09 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 09 0a 02 100e 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0a 0b 02 a00f 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0b 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0b 0c 02 3011 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0c 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0c 0d 02 c012 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0d 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0d 0e 02 5014 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0e 0f 02 0000 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
30 04 0f 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 04 1a0041000a 51383430353132 0f 10 02 9001 9001 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

Turns out we can find our somewhat familiar values here? Values of other capture seemed more like gibberish, but here we find similar values as for `32 02` requests.
In the previous capture, the last image seems to have correct value for the gif with size 595 (`0253`), so it might be that some other images were not available somehow? (I only play with 6 gifs)

### Upon starting CAM (`30 03`)

````
30 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 03 1a0041000a 51383430353132 04 01 000500ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

Other occurrence:

````
30 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 03 1a0041000a 51383430353132 04 05 000500ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

One value has changed from 1 to 5 here, so it has to have a meaning?

Other occurrence:

````
30 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
31 03 1a0041000a 51383430353132 04 0a 000a00ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

Then the value chanegd from 05 to 0aâ€¦ Could it be some FW version ?

### Upon starting CAM (`20 03`)

````
20 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
21 03 1a0041000a 51383430353132 0100000000000010000000000011 000000000000000000000000000000000000000000000000000000000000000000000000
````

After connecting one RGB Fan (F140RGB):

````
20 03 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
21 03 1a0041000a 51383430353132 01 14 00 00 00 00 00 10 00 00 00 00 00 11 00 00 00 00 00 00000000000000000000000000000000000000000000000000000000000000
````

The `14` is very certainly the ID for the 140mm Fan (as it does show as what it is in CAM)
A quick search points to this https://github.com/liquidctl/liquidctl/issues/541#issuecomment-1333035246, suggesting the following mapping:

* `13` F120RGB
* `14` F140RGB

Documentation [here](https://github.com/liquidctl/liquidctl/blob/main/docs/developer/protocol/nzxt_x3-z3-2023.md) indicates that the command should be `20 01` and that `10` and `11` would indicate presence of ring and logo channels, which does not make sense here.
I don't know what would be the reason for some devices to use `20 01` and some others `20 03`, maybe this doc is wrong or it depends on some kind of hardware version.

Anyway, according to this, it would be safe to assume that `01` is indeed the number of RGB channels.

In that case, I would assume that the 6 following bytes are RGB device IDs. (There seem to be space for 6 though ?)

From the official info from NZXT, a channel supports up to 40 leds OR 6 devices: https://nzxt.com/en-FR/product/rgb-and-fan-controller
Number of accessory devices supported seem to vary a bit between devices, but it seems logical that this one would support 6 then.

(I have yet to find a way to connect a second fan there. Damn you NZXT ðŸ™)

It should be reasonable to assume that `10` and `11` actually do represent the ring and logo accessory IDs, which would always be emitted by the firmware for convenience?
Since we only have a single channel, we would never be supposed to read those ID, meaning there wouldn't be any problem.

### Setting the Fan to different colors

White:

````
2a 04 01 01 00 3200 ffffff 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100120300000000
ff 01 1a0041000a 51383430353132 2a 04 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

Cyan:

````
2a 04 01 01 00 3200 ff00ff 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100120300000000
````

Magenta:

````
2a 04 01 01 00 3200 00ffff 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000100120300000000
````

This is the command to set a single uniform color. I assume that one of the parameters is the channel ID ?
The `32` is a bit weird and I doubt it is an effect ID. Maybe brightness (IIRC it was set to 100%) => No. Playing with the brightness just changes the RGB value.

My mistake for using these colors here as I didn't initially notice that the channels are not in RGB order, which I only noticed after testing the breathing effect.
The colors should be in G R B order, actually. Might be accessory-specific?

### Setting the Fan to multiple colors

This is the result of manually setting the wheel to an alternance of cyan and magenta, starting with the "top" led. (Starting from full white)

Top LED seems to be the first and is on the side of the cable, in the middle. Following one is the next anti-clockwise. (Although CAM UI shows it clockwise)

````
22 10 01 00 ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 01 00 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

(I verified that all these commands are actually validated with a `ff` result, no need to include that here)

We see batches of three commands here.

First one of the three obviously sets each individual led to its final color.
And as of writing that, I realize tha obviously the second one is just the continuation.
A channel has up to 40 LEDs and we can fit exactly 20 colors in a packet.

As such, `20 10` is the command to send RGB colors for the first 20 LEDs in channel order.
And then `20 11` is the command to send RGB colors for the last 20 LEDs in channel order.

We could probably entirely do away with the second command call in this case, but as always, RGB software takes programming shortcuts that will waste precious CPU resources.
(To be tested, of course, but I seriously doubt that it is not the case)

In both of those`commands, I would assume that the first parameter is the channel ID, but since there is only one channel hereâ€¦

Then, the last command is obviously an apply command.
One thing I can tell for sure is that the `12` matches oddly with the number of LEDs, so this is probably that. (I would presume that the preceding byte might be some kind of offset into the color buffer, but who knows)
First parameter, again, is probably the channel.
The `32` comes back from the single color command. It must really mean something, but no diea what.

### Breathing Effect

Just realized now that the controller actually exposes effects, so we should be able to learn moreâ€¦

Breathing effect seems to support from 1 to 8 colors to be cycled through.

````
2a 04 01 01 07 1400 00517a 000000 000000 000000 000000 000000 000000 000000 00000000000000000000000000000000000000000000000000 01 08 12 03 00000000
2a 04 01 01 07 1400 00517a 00ffff 000000 000000 000000 000000 000000 000000 00000000000000000000000000000000000000000000000000 02 08 12 03 00000000
2a 04 01 01 07 1400 00517a 00ffff ff00ff 000000 000000 000000 000000 000000 00000000000000000000000000000000000000000000000000 03 08 12 03 00000000
2a 04 01 01 07 1400 00517a 00ffff ff00ff 96ff00 000000 000000 000000 000000 00000000000000000000000000000000000000000000000000 04 08 12 03 00000000
2a 04 01 01 07 1400 00517a 00ffff ff00ff 96ff00 00ff00 000000 000000 000000 00000000000000000000000000000000000000000000000000 05 08 12 03 00000000
2a 04 01 01 07 1400 00517a 00ffff ff00ff 96ff00 00ff00 0000ff 000000 000000 00000000000000000000000000000000000000000000000000 06 08 12 03 00000000
2a 04 01 01 07 1400 00517a 00ffff ff00ff 96ff00 00ff00 0000ff ffffff 000000 00000000000000000000000000000000000000000000000000 07 08 12 03 00000000
2a 04 01 01 07 1400 00517a 00ffff ff00ff 96ff00 00ff00 0000ff ffffff e5ff00 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
````

With individual LED colors:

````
22 10 01 00 ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 03 19 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 03 19 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 03 19 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 03 19 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 03 19 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 ff00ff 00ffff ff00ff 00ffff ff00ff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff ffffff 000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 03 19 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

### Fade effect

Again supports up to 8 colors, NZXT does nto seem to propose setting individual LED colors for this one ?

````
2a 04 01 01 01 2800 00517a ff0000 0000ff 000000 000000 000000 000000 000000 00000000000000000000000000000000000000000000000000 03 08 12 03 00000000
2a 04 01 01 01 2800 00517a ff0000 0000ff 00ffff 000000 000000 000000 000000 00000000000000000000000000000000000000000000000000 04 08 12 03 00000000
2a 04 01 01 01 2800 00517a ff0000 0000ff 00ffff ff00ff 000000 000000 000000 00000000000000000000000000000000000000000000000000 05 08 12 03 00000000
2a 04 01 01 01 2800 00517a ff0000 0000ff 00ffff ff00ff ffff00 000000 000000 00000000000000000000000000000000000000000000000000 06 08 12 03 00000000
2a 04 01 01 01 2800 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff 000000 00000000000000000000000000000000000000000000000000 07 08 12 03 00000000
2a 04 01 01 01 2800 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
````

Different speeds:

````
2a 04 01 01 01 3c00 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
2a 04 01 01 01 5000 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
2a 04 01 01 01 3c00 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
2a 04 01 01 01 2800 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
2a 04 01 01 01 1400 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
2a 04 01 01 01 0a00 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
2a 04 01 01 01 2800 00517a ff0000 0000ff 00ffff ff00ff ffff00 00ffff ff00ff 00000000000000000000000000000000000000000000000000 08 08 12 03 00000000
````

Analysis:

* `50` : Slowest.
* `3c` : Slow.
* `28` : Normal speed.
* `14` : Fast.
* `04` : Fastest.

### Marquee effect

With varying speed: (Slowest to fastest)

````
22 10 01 00 00517a 00517a 00517a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 3c 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 00517a 00517a 00517a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 33 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 00517a 00517a 00517a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 29 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 00517a 00517a 00517a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 1f 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 00517a 00517a 00517a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 14 00 12 00 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

This one seems interesting, as we can clearly see 3 colors be assigned to the same value (single setting in the UI).
I assume this effect is actually simply implementing a color rotation and that the same command could be used to implement multiple other effects.

Changing the direction:

````
22 10 01 00 00517a 00517a 00517a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 14 00 12 01 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

The byte following `12` has been switched to `01`, so this is the direction.

Increasing the "size" up to 6:

````
22 10 01 00 00517a 00517a 00517a 00517a 000000 000000 000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 14 00 12 01 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 00517a 00517a 00517a 00517a 00517a 000000 000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 14 00 12 01 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 10 01 00 00517a 00517a 00517a 00517a 00517a 00517a 000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 a0 01 00 02 14 00 12 01 00 80 00 32 00 00 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

As expected, no change in the "apply" command, so it is just a color rotation. (Nice, though)

### Covering Marquee effect

In order: 2 to 8 colors, then speed, then reverse
````
2a 04 01 01 04 fa00 0000ff ff0000 000000 000000 000000 000000 000000 000000 000000000000000000000000000000000000000000000000 04 02 00 12 03 00000000
2a 04 01 01 04 fa00 0000ff ff0000 ff00ff 000000 000000 000000 000000 000000 000000000000000000000000000000000000000000000000 04 03 00 12 03 00000000
2a 04 01 01 04 fa00 0000ff ff0000 ff00ff 00ffff 000000 000000 000000 000000 000000000000000000000000000000000000000000000000 04 04 00 12 03 00000000
2a 04 01 01 04 fa00 0000ff ff0000 ff00ff 00ffff ff00ff 000000 000000 000000 000000000000000000000000000000000000000000000000 04 05 00 12 03 00000000
2a 04 01 01 04 fa00 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff 000000 000000 000000000000000000000000000000000000000000000000 04 06 00 12 03 00000000
2a 04 01 01 04 fa00 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 000000 000000000000000000000000000000000000000000000000 04 07 00 12 03 00000000
2a 04 01 01 04 fa00 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000000000000000000000000000000000000000 04 08 00 12 03 00000000
2a 04 01 01 04 5e01 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000000000000000000000000000000000000000 04 08 00 12 03 00000000
2a 04 01 01 04 2c01 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000000000000000000000000000000000000000 04 08 00 12 03 00000000
2a 04 01 01 04 fa00 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000000000000000000000000000000000000000 04 08 00 12 03 00000000
2a 04 01 01 04 9600 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000000000000000000000000000000000000000 04 08 00 12 03 00000000
2a 04 01 01 04 5000 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000000000000000000000000000000000000000 04 08 00 12 03 00000000
2a 04 01 01 04 5000 0000ff ff0000 ff00ff 00ffff ff00ff 00ffff ff00ff 00ffff 000000000000000000000000000000000000000000000000 06 08 00 12 03 00000000
````

Ok, so I just noticed that parameters actually exist at the far end of the command buffer.

Byte is `06` for the "forward" direction (arrow to the right in CAM UI) and `04` for the "backward" direction (arrow to the left in CAM UI)

We also do find the actual number of colors used. (I wondered if the controller was just guessing it from the empty color slots, but apaprently not) and the number of leds.

Parameter that has the value `03` unknown.

### Wings effect

I have not yet detailed all the othe effects before this one, but most exist in at least the "simple" flavor.
Wings seems interesting because it looks totally different.
Upon activating it, quite a few packets are sent to the device.
It looks as if the device was being sent explicit frames to renderâ€¦ Which I'm reasonably confident is the case.
If true, that's huge. (Potential for many fun things)

````
22 10 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 11 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 20 01 00 04 39 00 01 000000000000000209890000000000000000000000007f00007f000000000000000000000000000000000000000000000000000000000000
22 20 01 01 04 39 00 01 0000000000000002098900000000000000000000000032000032000000000000000000000000000000000000000000000000000000000000
22 20 01 02 04 39 00 01 000000000000000209890000000000000000000000000c00000c000000000000000000000000000000000000000000000000000000000000
22 20 01 03 04 39 00 05 0000000000000002098900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 20 01 04 04 39 00 01 000000000000000289090000000000000000000000007f00007f000000000000000000000000000000000000000000000000000000000000
22 20 01 05 04 39 00 01 0000000000000002890900000000000000000000000032000032000000000000000000000000000000000000000000000000000000000000
22 20 01 06 04 39 00 01 000000000000000289090000000000000000000000000c00000c000000000000000000000000000000000000000000000000000000000000
22 20 01 07 04 39 00 05 0000000000000002890900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22 03 01 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
````

So this starts by clearing out the LED buffer for some reason. Maybe not necessary at all, but will need to be tested.

Then, multiple instances of the command `22 20` are sent out. First parameter likely being the channel, so uninteresting.
But we can clearly see the second parameter increasing from `00` to `07`, which is totally in line with the idea of multiple frames being uploaded.

This is followed by a `22 03` command, of which the second parameter is `08`, exactly the number of (supposed) frames written.

Now, the contents of the "frames" above seem a bit hard to understand, but I've come to realize that's because the initial color is blue.
If we try white, the result seems more easily understandable:

````
22 20 01 00 04 3900 01 00000000000000 02 09 89 00000000000000000000 7f7f7f 7f7f7f 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
22 20 01 01 04 3900 01 00000000000000 02 09 89 00000000000000000000 323232 323232 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
22 20 01 02 04 3900 01 00000000000000 02 09 89 00000000000000000000 0c0c0c 0c0c0c 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
22 20 01 03 04 3900 05 00000000000000 02 09 89 00000000000000000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
22 20 01 04 04 3900 01 00000000000000 02 89 09 00000000000000000000 7f7f7f 7f7f7f 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
22 20 01 05 04 3900 01 00000000000000 02 89 09 00000000000000000000 323232 323232 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
22 20 01 06 04 3900 01 00000000000000 02 89 09 00000000000000000000 0c0c0c 0c0c0c 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
22 20 01 07 04 3900 05 00000000000000 02 89 09 00000000000000000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000
````

This at least makes the place where some colors appear clear. I've delimited places where I assume other colors could be present, but it will be hard to know for sure without doing some tests.

After investigating this effect, I can tell confidently a few things:

* If everything is set to 0, then the colors from the LED buffer would show up in a relatively nice traveling effect.
* The parameter we observe being `01` and `05` is some kind of play duration/visual length of the effect.
* If we increase the duration parameter (e.g. I used 20), we can see that the effect is filling out the LED area from both ends
* The parameters that are `09` or `89` use the most significant bit to indicate the effect direction
* My fan has 18 LEDs. I can therefore conclude that the value `09` or `89` corresponds to that.
* The parameter with value `3900` is the speed, siliar to what exists for normal effects. If would be something like number of clock ticks between each animation tick.

Things are very weird when the "duration" is very low such as in the preset from CAM, and every zone seems to behave somewhat differently.
Basically, we can see the colors mix up. I would assume that each animation does run for a few extra frames and this causes weirdness.

So my guess would there is that effects are always running their entire length, which is when the LEDs have all been updated, however, their colors are always overriden with the ones from the effect that started afterwards.
This is so wird, though, and I do doubt that the controller can keep track of that many things, especially as it works nicely when the effect "restarts" (no flicker, just continuation)

So, here is what I think happens:

This is not really composed of frames, but as a sequence of operations.

For each operation:

* The entire LED channel is cut in multiple arbitrary zones of a given LED count, up to 12 zones (a channel can have up to 6 accessories; an accesory would use two zones given how CAM does it; there is space for exactly 12 zones)
* Each zone is provided with one color
* Each zone has a direction bit
* A shared duration is specified, in terms of the number of LEDs affected, one LED per tick (not strictly verified but this makes sense)
* For each zone, the corresponding color array will be shifted by one in the configured direction ("forward" or "backward"), and the configured color will be put in the free slot

This means that some colors can be provided outside of the effect itself (such as the addressable color buffer, which is cleared by CAM) and persist for some amount of time, or, forever.

For example, in the commands sent above by CAM, the total duration of each direction would be `8`, which meant that there would always be one parasitic color remaining (as there are 9 colors per side).
Also maybe why I didn't understand what their "wings" effect was doing. The visual is kinda fucked up.

So, after more testing, I'm confident enough that the buffer is always initialized to contain the colors that are set using the addressable command.

I also do suspect that the parameter that stays at the value `04` might allow showing different effects. (Especially because `04` is the covering marquee effect in the "simple" effect logic)
I only did one random try with the value `03` and nothing happened, though.
I tested various values of this setting and nothing useful happened. However, during my testing, I may have stuck the first led(s) to be permanently offset to green and couldn't find what exact command did this.
(It was when the led buffer was set to full yellow for the first 20 colors)

### Setting a multicolor effect `22 04`

This function is used to set built-in effects that take a variable list of colors as parameters. Number of colors supported will vary depending on the effect.

````
22 04 <Channel:U8> 01 <Effect:U8> <Speed:U16> <Colors:RGB[8]> <Zero:U8[24]> <Parameter1:U8> <ColorCount:U8> <Parameter2:U8> <LedCount:U8> <Parameter3:U8> 00 00 00 00
````

NB: It is likely that the `01` following the Channel Index is the Accessory Index, but until I have a way to confirm that, let's just consider it to be a fixed value.

It is difficult to tell the exact meaning of each of the 3 parameters.

One of the uses of Parameter1 is reversibility of the effects, but it does also have other purposes.
I suspected this parameter is generally a bit field, and I tested that hypothesis with the Tai Chi effect (which cannot be reversed in CAM).
For "covering marquee", the effect direction is controlled by a change between `04` and `06`.
Which, if we assume that the parameter is a bit field, indicates that bit 1 (with the value `02`) actually controls the direction.
Turns out that this does also work for the Tai Chi effect. Setting the parameter to `01` did nothing, for example, but `02` does reverse the effect.

Parameter2 seems to be speed-related too ?
Setting it to `00` on the TaiChi effect makes it go very fast, and `10` very slow, even on the "faster" animation setting.
Might be the delay necessary for a color transition or something like that. To be investigated more in depth later.

Parameter3 is generally `03` but is used by the "alternating" effect as the size of the area.
I would imagine that that parameter can be used similarly with other effects that have a moving animation.

Many effects set from CAM will assign a constant predefined value for some of those parameters.

Effects:

* `00` Static (1 color)
* `01` Fade (1-8 colors)
* `02` Spectrum Wave (Reversible; 0 colors but parameter set to 1)
* `03` Marquee (Not exposed in CAM for some reason, they always prefer the addressable version of it (looks, maybe); parameters should be similar to the covering marquee effect)
* `04` Covering Marquee (Reversible; 1-8 colors, 2 by default)
* `05` Alternating (Reversible; Static or moving; Variable size; 2 colors)
* `06` Impulse (1-8 colors)
* `07` Breathing (1-8 colors)
* `08` Candle (1 color) (This effects produces random-looking color variations that suggest the fluctuations of a candle, especially with the default color assigned from CAM, #FFA500)
* `09` Starry Night (1 color)
* `0a` Blink ? (Using the speed parameters from covering marquee which are supposed to be quite slow, this is still quite fast. Maybe bad for epilleptics?)
* `0b` Rainbow Wave (Reversible; 0 colors but parameter set to 1) (Colors will move in blocks from first to last led
* `0c` Super Rainbow Wave (Reversible; 0 colors but parameter set to 1) (This effect is a better mix of "rainbow wave" and "spectrum wave")
* `0d` Rainbow Impulse (Reversible; 0 colors but parameter set to 1) (More like spectrum chase ?)
* `0e` Tai Chi (1-2 colors) (The LEDs are 50% color 1 50% color 2, with areas moving from start to end. Effect works well on circular zones, and I suspect it is actually reversible (Confirmed !))
* `0f` Liquid cooler (Two colors; Hardcoded to Red and Blue in the command passed from CAM; color count set to 1 somehow?) (Zone is split in two likeâ€¦Â a thermometer ? then an impulse moves from start to end. I have a hard time telling if it is related to the liquid temperature in any way)
* `10` Loading (1 color) (Imitates one of those infinite progress bars with a rectangle moving from start to end, I guess?)

### To be continuedâ€¦

There are too many effects on this controller/software ðŸ˜…

### .

````
31 04 1a0041000a 51383430353132 01 02 02 21196c0d 01 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000
````
