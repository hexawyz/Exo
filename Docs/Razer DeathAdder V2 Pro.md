This device and the compatible dock can work without any driver, but if we want to configure it and play with the RGB features, we need to analyze the protocol.
I sacrificed my computer for science and installed the terrible software that Synapse 3 is, and the experience was less than pleasing.

One interesting thing is that as soon as the installer started, some requests were emitted on the two devices, likely to get information, using feature reports.

SET => 000800000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400            
GET => 020800000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400                    

SET => 000800000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400            
GET => 020800000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400                    

After that, when starting the actual installation, the bloated software sent a huge lot of requests, while taking several minutes to do what should have been nothing…
And messed up with ALL USB devices on the system. ALL of them. Competitor's mouse, Stream Deck, etc. TWO TIMES. My other mouse stopped working for tens of seconds while this was happening.
It seems it was doing some nasty stuff to the windows USB stack. At least something like restarting it, but maybe it installed some kind of filter driver on the system.
Indeed I see two drivers files, "RzDev_007c.sys" and "RzDev_007e.sys" associated with the mouse (USB dongle) and Dock. I'm unsure they were here prior to this.
Worthy of note, is that this crappy software asked me to restart the system after the installation, as was also notified by the windows driver install popups.
It did still seem to somehow work without doing that.
Let's hope these drivers are not a vital part of anything.

Upon starting razer synapse, it started emitting a lot of requests to the device. This was presumably to manually orchestrate the color cycling effect, which is also an hardware effect -_-
From testing around with Wireshark still opened, it would seem as if all effects are implemented in software using regular frequency manual color updates. Even fading out to black, etc.

# Analyzing the protocol

As often, Wireshark is operating a bit weird here. It seems unable to interpret the data part of GET feature responses while present in the packet.

When starting Synapse 3:

SET => 001f00000002008400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
GET => 021f00000002008400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600

SET => 001f00000002000403000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
GET => 021f00000002000403000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

First of all the n-1 byte of a packet (89th byte out of 90) seems to be a checksum of sorts. (We see that value constantly changing, and it is well isolated)
Judging by the requests/responses above, this is definitely a XOR checksum of all the bytes except for the fist two and last two.

BTW we can see the installer using various report IDs to communicate with the devices, but they are probably not the ones we are interested in for now. (We cans till dig in the captures later)
The report shown above (report ID 0 of 90 bytes) is the one we are interested in and is likely the standard razer protocol for these devices.

Hopefully, the razer protocol is relatively universal across devices. (Which I seem was the rational for devices supported in Synapse 3 vs those only supported by Synapse 2)
If that's the case, what we find here can be reused more widely 🤞

This is a request that seemingly sets the RGB color on the dock:

SET => 001f000000080f030000000000ff5f04000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a000

Since these are (always?) sent using feature reports, they don't expect any response other than an ack from the device.

We can see what seems to be the color above: ff5f04. This was chosen semi randomly from a long sequence of similar requests.
The color values that are sent to the device seem somewhat strange, as they are not the aggressive FF0000 => FFC000 => FF8000 etc. sequences that we would usually see.

It seems that all requests start with `001f`.
For the dock, it seems that all responses start with `021f`, but for the mouse USB dongle, it seems that responses can be either `021f` or `011f` followed by `021f` (two responses).

I'm assuming the first byte is an indicator of the origin of the request.
So it would be something like:
`00` is the host (Computer)
`01` is a USB receiver (But values are not always communicated ? It behaves like it could be the device itself but doesn't return useful info such as battery status)
`02` is the actual device, connected directly or through a receiver. If connected through a receiver but the device is offline, the responses will be mocked by the receiver ?

If there is a `01` response, there is always a `02` response following. But a `01` never follows a `02`.

Or maybe, because later on, we get multiple `01` responses in sequence, this is an indicator of request completion.
In that case, the meaning of the first byte would be:
`00` is a request (always from host to device)
`01` is a non-final response (always from device to host), and more responses must be fetched with a further Get Feature call
`02` is a final response (always from device to host), meaning that all the data has been received.

The second byte actually can take the value `08` or `1f` but it will be `1f` for most requests. It seems the `08` is mainly used during software initialization.
However there are requests using `020086` with both `08` and `1f` as the second byte, so I'm unsure of its meaning.

Let's ignore the checksum byte and trim the requests to compare various requests sent to the device


001f 000000 02 00 84  # ?
001f 000000 02 00 04 03 # ?
001f 000000 02 00 86  # ?
001f 000000 08 0f 03  # ?
001f 000000 06 0f 02 00 00 08 00 01 # ?
001f 000000 08 0f 03 0000000000 ff5f04 # Set color
001f 000000 08 0f 03 0000000000 ff5e04 # Set color
001f 000000 08 0f 03 0000000000 ff6004 # Set color
001f 000000 08 0f 03 0000000000 00ff00 # Set color (To green, done in the UI)
001f 000000 03 0f 04 01 00 54 # Set brightness
001f 000000 03 0f 04 01 00 ed # Set brightness

The excerpts below are the parts where I tried to adjust the effect brightness:

001f000000030f04010049
001f000000030f04010082
001f000000030f040100ad
001f000000030f040100ba
001f000000030f04010038
001f000000080f03000000000000ff00 // Green (Static Color defined in the UI)
001f000000030f0401003d
001f000000030f04010047
001f000000030f04010051
001f000000030f04010051
001f000000030f04010054
001f000000030f040100ff

001f000000030f040100ed
001f000000030f040100c9
001f000000080f03000000000000ff00 // Green (Static Color defined in the UI)
001f000000030f040100af
001f000000030f04010091
001f000000030f04010084
001f000000030f04010059
001f000000030f0401003d
001f000000030f04010035
001f000000030f0401003d
001f000000030f04010044
001f000000080f03000000000000ff00 // Green (Static Color defined in the UI)
001f000000030f0401004c
001f000000030f0401004f
001f000000030f0401004f
001f000000030f04010054 // Brightness to 33 ?

Default brightness was "33" in the UI, so we would be looking for 0x21 or 0x55 if the values are based on 255 (which they seemed to be)…
Turns out the last command ends with the value 0x54 (after a manual reset to the value "33", which is a too close match to be a coincidence)

It seems that Razer software is sending/receiving all reports to/from endpoint 0 with report ID 0… And I can't make sense of that. (No HID descriptor seem to match and I believe I tried all device names just in case)
Might be a problem with USBpcap or Razer doesn't exactly respect the USB stack, which would explains why they have a proprietary (filter?) driver for each of their devices.
So, bad news probably. Unless I'm able to find the IO control codes to communicate with their drivers, it seems complicated for now.

To extract a large number of requests from a capture: (Sadly doesn't work for the GET FEATURE reports of these devices 🙁)
`tshark' -r "INPUT.pcapng" -T fields -e usb.irp_info.direction -e usb.data_fragment "usb.data_len >= 90 and usb.device_address == 48" > OUTPUT.txt`

Sending invalid requests to the device seem to generate responses starting with `03`. I am thus assuming that `03` indicates an invalid command. (Maybe due to the state of the device)
It seems responses starting with `05` can also be received to indicate an error. (Trying to enable the reactive effect on the dock does that 🙂)

So far, I'm assuming the meaning is that of a status code:

	- `00` Request
	- `01` Please Retry (It seems the checksum can often be invalid in this case ? Did not notice that before, but the dock seems to do that)
	- `02` Success
	- `03` Invalid Command Parameter ?
	- `04` Not Available
	- `05` Invalid Command Parameter ?
	- `NN` Other error

## Observations from all the stuff below

NB: I've yet to understand how USB receivers would work with multiple devices. (I've only got one)

### General observations

Data larger than one byte in the protocol tend to use the Big Endian byte order.

Percentages are generally expressed as byte values from 0 to 255 instead of 0 to 100. (e.g. 33% will be the value 84 or 0x54)

### Format used in message structures below

<NAME:TYPE> => This is an element of the message named NAME with the following TYPE.

TYPE:
U8: 8-bit unsigned integer
U16: 16-bit unsigned integer
RGB: <R:U8> <G:U8> <B:U8>
P8: percentage scaled from 0 to 255, expressed as a 8-bit unsigned integer.
X[N]: Array of N items of type X

### Device notifications

Because the core protocol is based on raw get/set feature calls on the root device itself and does not actually follows the standard HID operation mode, hence requiring specific drivers,
notifications are emitted on a separate and much more standard channel. They will use standard HID output reports accessible through standard ReadFile calls (FileStream in .NET).

These HID reports are exposed on Device Interface 5.
The report ID `05` is used to transmit notifications from the connected device or its child devices, as packets of exactly 16 bytes including the report ID.
Other report IDs with the same structure exist, but I've not observed them in any trace yet.
Because notifications do not always contain a device ID, I suspect these other reports could be used in this case?

#### Structure of a notification.

All notifications follow a very simple format:

``` 
<Report ID:U8> <ID:U8> <Data:U8[14]>
```

The HID report ID is part of the HID protocol and will be `05`.

The ID is a notification ID.

The rest is message data associated with the notification ID.

#### Known notifications

##### 02 - Device DPI

Structure:

```
<DPI X:U16> <DPI Y:U16>
```

This notification will be sent when a DPI change request has been processed by the device as the result of clicking one of the DPI buttons.
It will always be sent, even if the DPI did not actually change, for example if it was already at the minimum or maximum setting.

##### 09 - Device Connection Status Change

Structure:

```
<Status:U8> <Device Index:U8>
```

This notification is sent when a device connected to a receiver changes from being offline to online, or from being online to offline.

The Status will be `02` if the device is now offline, and `03` if the device is now online.

The device index seems like a fair interpretation, but it stills need to be confirmed.

##### 0C - External Power

Structure:

```
<Status:U8>
```

This notification is sent when the device is connected to or disconnected from external power.

Status will be `00` if the device is not connected and `01` if the device is connected.

### Function/Register based protocol

The core protocol is composed of SET/GET feature calls to the root device itself. It does not strictly follow the HID spec, and is not exposed by any HID report.
On windows, a special driver is needed to communicate with the device. The official Razer driver will expose a new "Razer control" device interface to communicate.

IO Control Codes are used to implement the GET and SET feature calls:

- SetFeature: 0x88883010
- GetFeature: 0x88883014

Packets are always 91 bytes long, including the report ID which is `00`.
This means that commands themselves are 90 bytes long.

All messages follow a common pattern:

```
<Status:U8> <Unknown_0:U8> <Zero:U8[3]> <Length:U8> <Feature:U8> <Register:U8> <Data:U8[80]> <Checksum:U8> <Zero:U8>
```

The Status byte will be as follows:

- `00` Request
- `01` Retry again
- `02` Success
- `03` Error (Invalid Parameter ?)
- `04` Device Not Available
- `05` Error (Invalid Parameter ?)

The following byte, labelled as unknown, is either `08` or `1f`, but usually `1f`. I suspect this indicates the device to communicate. Maybe a channel ID or internal chip ID.

These are followed by three bytes seemingly always zero.

Then, the next three bytes form the actual command:

The first byte seems to be a data length of some sort. It seems to often be the same in matching request and response messages, but sometimes differ.
However, the number is always larger than or matching the number of non-zero bytes in the response,
indicating that it could be the the max requested length for requests and the response length for responses?

The second byte appears to be a Category or Feature ID similar to what is used by logitech HID++. Some values were observed in the requests below:

- `00` General / Core device features
- `02`
- `04` Profile-related (DPI levels)
- `05`
- `06` Mouse-related (DPI, etc.)
- `07` Power
- `0b`
- `0f` Lighting

The third byte appears to be composed of multiple parts:

The most significant bit is the read/write bit. Set, it will indicate a read command. Unset, it will indicate a write command.
The 7 remaining bits indicate the register or function ID.

e.g. `80` would mean "Read register 0", and `00` would mean "Write register 0"

⚠️ Still needs confirmation for values such as `bb`: Is it paired with `ab`, or is it something else ?

All the bytes following this, up to the last two, represent the command data.

This data is followed by a checksum byte which is a XOR checksum of all previous bytes but the first two bytes. It is followed by a null byte.

Unless the command was a successful read, status responses seem to always include the whole original command, meaning the checksum is also unchanged in that case.

#### Features

##### 00 - General

###### 01 - ???

###### 02 - Serial Number

Read Request: Empty

Read Response:

```
<Serial Number:U8[]>
```

The serial number is a null-terminated string. (If less long than the response buffer)

###### 04 - ???

###### 05 - Polling Frequency

Read Response:

```
<Divider:U8>
```

Write:

```
<Divider:U8>
```

The parameter to this command is a frequency divider from the maximum frequency. (How do we know the maximum frequency then ?)

e.g. 1000Hz is 1, 500Hz is 2, 125Hz is 8


###### 06 - ???

###### 07 - ???

###### 3B - ???

###### 3C - ???

001f0000000300bc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00
021f0000000300bc0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00

###### 3F - Pairing information

Read Request:

```
<DeviceCount:U8>
```

Read Response:

```
<DeviceCount:U8> <DeviceInfo:<Status:U8> <ProductID:U16>[]>
```

It seems that for the input, the device count, is the requested maximum count ?
Some requests have the value `02` and some have the value `10`, but all the responses have `02`.
The value `10` makes sense, as the message length `31` could fit exactly 16 device information structures. (Each is 3 bytes long)

For each device, the connection status is either `01` if the device is online, or `00` if the device is offline.
The product ID is the USB product ID. However there is a quirk there, as receivers share the same product ID as their associated product.

###### 45 - Device ID ?

Read Request: Empty

Read Response:

```
<DeviceCount:U8> <ProductID:U16[]>
```

This returns similar information to the pairing information stuff.

Maybe this is used to confirm the ID of the connected device ? It would be useful for multiple device stuff, I guess.

##### 04 - Mouse

###### 05 - DPI Level

Read Request:

```
<Persisted:U8>
```

Read Response:

```
<???:U8> <DpiX:U16> <DpiY:U16>
```

The first byte has been observed to be both `00` and `01` depending on the situation.
Logically, it would either indicate that the setting must be or is persisted, or that the horizontal and vertical DPIs are linked.
The first possibility might be the most likely.

###### 06 - Predefined DPI levels

Read Request:

```
<Persisted:U8>
```

Read Response/Write Request:

```
<Persisted:U8> <ActiveProfile:U8> <ProfileCount:U8> <DpiPresetList:<DpiPreset:<Index:U8> <DpiX:U16> <DpiY:U16> <DpiZ:U16>>[]>
```

This is still guesswork, but assuming the format of the packets we received it makes sense that each profile would define three DPI values for X, Y and Z, with Z being zero if unsupported.
The meaning of the first byte is assumed to be the persistance state, and should be `00` for volatile memory and `01` for non-volatile memory. This could be wrong, though.
The Razer Synapse software only seems to write values where the first byte is set to `01`.
The second byte has been confirmed by simple testing to be the active profile index (e.g. `04` is the 4th profile on a mouse with `05` profiles).
It follows logically that the following byte should be the number of profiles.

##### 07 - Power

###### 00 - Battery Level

Read Request: Empty

Read Response:

```
<Zero:U8> <BatteryLevel:P8>
```

###### 01 - Low Power Mode

Write:

```
<BatteryLevel:P8>
```

The low power mode is entered after when the device's battery level goes below the specified percentage.

###### 03 - Power Saving

Write:

```
<Duration:U16>
```

The duration before the device enters sleep mode is expressed in seconds.

###### 04 - External Power Status

Read Request: Empty

Read Response:

```
<Status:U8>
```

Status is `01` if external power is connected, and `00` otherwise.

##### 0F - Lighting

###### 00 - Lighting device information ??

Read Response:

```
<Magic:U8> <Unknown:U8> <Unknown:U8> <Unknown:U8> <Unknown:U8>
```

The meaning of the bytes is not certain, but the first byte returned seems to be important for other commands.
It could very well be a "RGB Lighting feature version" thing.

Typical response examples:

04 19 03 02 02 (Razer DeathAdder V2 Pro)
05 19 03 01 02 (Razer Mouse Dock)

###### 02 - Current Lighting Effect

Read Request:

```
<Persist?:U8> <Magic:U8>
```

Read Response:

```
<Zero:U8> <Magic:U8> <Effect:U8> <Parameter0:U8> <Parameter1:U8> <ColorCount:U8> <Color0:RGB> <Color1:RGB>
```

Write:

```
<Persist:U8> <Zero:U8> <Effect:U8> <Parameter0:U8> <Parameter1:U8> <ColorCount:U8> <Color0:RGB> <Color1:RGB>
```

The parameters passed to read commands are usually `01` followed by the "magic" byte read from the device information earlier.
This value seems to be important, and *can* be passed at the same place in write responses, but it does not seem necessary.
Passing another value than this or zero in a write may result in weird behavior of the device.

###### 03 - Current Color

Write:

```
<Zero:U8[5]> <Color:RGB>
```

This sets the current color of the device, in "streamable"/addressable mode.
It ignores the current effect and overrides it.

###### 04 - Brightness

Write:

```
<Persist?:U8> <Zero:U8> <Brightness:P8>
```

This writes the lighting level used for all lighting on the device. (Reading doesn't seem to work)
I'm assuming the first byte is a persistance flag similar to setting the color effect, but it needs to be verified.

## Requests sent to devices when the service is starting

### Dock

SET => 00 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

Still wondering about the above command, as it seems to return no information. (Handshake of some sorts ?)

SET => 00 08 000000 160082 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009400
GET => 02 08 000000 160082 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000de00
													   SN

The above command does return the device Serial Number in ASCII form (as written on the sticker)

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 02 00 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000

The above command seems to return some information. Maybe the firmware version ? (Need to check in Synapse UI)

### Mouse (Dongle)

SET => 00 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

This really could be the handshake command. It is sent by the Razer Synapse Installer, and always sent when a device is detected by Synapse Service.
It will return an error if the device is not connected to the dongle. (But then how does all that work when there are two devices ???)
It seems the service retries that one **many** times until it works, and it reads the (`04`) response up to 5 times per try.
The five read retries are probably not necessary, as it seems the devices will always respond to the last command.
That is also probably why no-op replies usually includes the whole request. (So that services can determine if they are reading the proper reply)

SET => 00 08 000000 160082 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009400
GET => 02 08 000000 160082 xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cc00

Obviously the serial number. That one will also fail if the device is not connected. (And same, how does this work when there are two paired devices)

SET => 00 08 000000 3100bf 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008c00
GET => 02 08 000000 3100bf 02 01 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000

Device pairing information, as it seems. Even though it is associated with a mouse (it has the PID of the mouse), the dongle here supports two devices and only one is paired.

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

Why does this very same command sometimes return 2 values and sometimes only one ? Definitely looks something firmware-related, though.

SET => 00 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 01058a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e00
GET => 02 1f 000000 01058a 05 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b00

SET => 00 1f 000000 010580 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 010580 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

SET => 00 1f 000000 410581 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c500
GET => 02 1f 000000 020581 05 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

This one command is one of the only for which the response has not the same 3 bytes sequence. The first byte is `41` in the request and `02` in the response.
Other commands usually have the same sequence for requests and responses.

SET => 00 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 0e068e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
GET => 02 1f 000000 0e068e 00 64 00 05e0 00 00 05e0 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e200

The `64` in the command above might be the battery level ? (I don't remember the exact charge level at this moment, but this could be 100% ?)
We also see 05e0 repeated two times, but the particular meaning of that is unclear.

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 01058a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e00
GET => 02 1f 000000 01058a 05 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b00

SET => 00 1f 000000 010580 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 010580 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

SET => 00 1f 000000 410581 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c500
GET => 02 1f 000000 020581 0501 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

SET => 00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
GET => 02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

SET => 00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
GET => 02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

## Specific Requests (On the Mouse)

### Shutting down Synapse when the color was Static (00FF00)

00 1f 000000 320f80 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd00
01 1f 000000 320f80 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd00
02 1f 000000 050f80 0419030202 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009400
00 1f 000000 0c0f82 0104 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 0c0f82 0104 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 0c0f82 000403012801 00ff00 00ff00 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ae00
00 1f 000000 060f02 0100030128 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
01 1f 000000 060f02 0100030128 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
02 1f 000000 060f02 0100030128 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
00 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
01 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 020084 03 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
00 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

We can compare this to shutdown for the dock:

00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00
00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

00 1f 000000 320f80 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd00
02 1f 000000 050f80 0519030102 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009600

00 1f 000000 0c0f82 0105 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
02 1f 000000 0c0f82 0005030028 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000af00

Of notable interest here, we see that the `05` is also found in the command above, while in the other trace for the mouse, it was a `04` in both.
When trying to manually send this command to the mouse, I got a new kind of error response (`03`), which is an interesting discovery.
I'm assuming there is a relation between the two commands here.
i.e. For some reason, the value in the second command has to be the value from the response to the first command.

00 1f 000000 060f02 0100030028 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002100
02 1f 000000 060f02 0100030028 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002100

This is one other of those differences here.
MOUSE: 0100030128
DOCK : 0100030028
I'm wondering if that is controlling the effect. (I'm really struggling to find any differences between the different runs)

00 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 020084 03 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
00 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

### Shutting down Synapse when the effect was color cycling

As always, the color cycling is done manually when Synapse is active.

00 1f 000000 080f03 0000000000ff170e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e200

00 1f 000000 320f80 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd00
01 1f 000000 320f80 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd00
02 1f 000000 050f80 0419030202 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009400

00 1f 000000 0c0f82 0104 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 0c0f82 0104 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 0c0f82 000403012801 00ff00 00ff00 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ae00

00 1f 000000 060f02 0100030128 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
02 1f 000000 060f02 0100030128 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000

-- Break

NB: the sequence `030128` is exactly found in the response to the previous command, implying the would be related.

This one is strange here because it is exactly the same as for the static color stuff above ? So it wouldn't actually be the effect command ?
I'll do another capture with static effect just to be sure.

Test redone:

CYCLE : 001f000000060f0201000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
STATIC: 001f000000060f0201000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000

It is actually the same, so I'm at a loss here. Does this mouse only have two modes ?
It actually seems synapse is reverting to color cycle when closing down, so one of the various commands here is "enabling" the color cycle.

Tested: Executed a distorted version of this command and it faded the color to black: 001f0000000c0f020104.
The response I got when calling this manually was: 021f0000000c0f020104 (Same as the input)
Executing the command `0c0f82` afterwards (the one I was trying to call), returns 021f0000000c0f82000400000000000000000000, so the colors we could see previously are likely gone.
So there is some way to store some color settings in the mouse, but I still need to find how this works.
I'm actually thinking the `0c0f82` command is a way to read the current settings and `060f02` is a way to set the current settings ?

Tested: This command, as-is (`00 1f 000000 060f02 0100030128`), actually enables the color cycling.
So it **is** related to setting the current effect.

If I change the value `28` to something else, it clears many bytes in the response.
If I add `01` after `28` like in the response from the previous command, it is returned in the response, but no other changes are visible.
Setting the first `01` byte to `00` still enables the color cycle.
If I change the following byte from `00` to `01`, the command returns an error.
If I change the next byte from `03` to `02`, it enables a new effect !! This one is a combination of color pulse and color cycle. (It this what is named the breathing effect ? Need to check what synapse does)
Setting this byte to `01` does fade the color to black. It does not seems to do anything else, but it could be an effect with color parameters.
Same if the byte is set to `00`.
If the byte is set to `04`, it seems to enable a very fast color cycle ? It could very well be some color wave effect on devices having more than one single LED.
When this effect `04` is enabled, changing the byte `28` to `FF` makes the effect relatively slower (there are no smooth transitions between colors), so it could be timing-related as I suspected.
(0x28 is 40 so it didn't look like a purely "random" value)
NB: Except for the standard color cycle, the color always fades to black before the effect starts, which would explain the fade to black effect of `00` and `01`.

Let's name the bytes so this is clearer:
01 00 03 01 28
AA BB EE CC TT

When E = 00, the color fades to black, implying this could be a valid effect ?
When E = 01, the color fades to black, implying this could be a valid effect ?
When E = 02, it enables a color pulse effect with what actually seem to be semi-random colors. (Those are often identifiable colors but sometimes the colors very close to white)
When E = 03, it sets the standard color cycle effect
When E = 04, if C = 00, the fast color cycle gets stuck (on red ?); if C = 02 the effect seems to work; if C = FF the effect is stuck also (on red) ? Same with value 03.
When E = 05, it immediately switches to black (no effect ?)
When E = 06, it returns an error (implying all other values are actually valid effects)

Starting synapse with the reactive color effect (with green color) previously enabled, it sends the following in sequence:
1: 001f000000060f02 00 00 08 00 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200
2: 001f000000080f0300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
3: 001f000000060f02 00 00 08 00 00 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300

This would imply that E = 08 is the reactive effect ?

Also, doing another test sequence, it seems that the value returned by `0c0f82` is affected by one of the following commands:

00 1f 000000 0c0f82 01040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 0c0f82 01040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 0c0f82 00040301280100ff0000ff000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ae00

00 1f 000000 060f02 01000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
01 1f 000000 060f02 01000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
02 1f 000000 060f02 01000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000

00 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
01 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 020084 03000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

00 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

00 1f 000000 0c0f82 01040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 0c0f82 0004030128000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000af00

00 1f 000000 060f02 01000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
01 1f 000000 060f02 01000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000
02 1f 000000 060f02 01000301280000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000

00 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600

Also, I'm actually starting to notice a pattern in these commands.
It would seem there is a relation between read and write commands.
See for example `0c0f82` and `060f02` that I've been looking at here… They seem clearly related and it seems that `82` gets the value of `02`.
A lot of commands in the dumps here are either `0N` or `8N`. It could very well be that the `8N` commands are read commands associated with a corresponding `0N` write command.
We also have a similar sequence (yet unexplained) of `020084` and `020004` above, which would kinda support this too.
It is possible that `84` is the "get current effect" command (without all the parameters like `82`) and that `04` is used above to reset the effect to default ?
This will be relatively easy to test later => Confirmed by transforming the "Set DPI" feature sent by synapse into a "Get DPI" 🙂 (`070405 00 1900 1900` into `070485` returning `070485 00 1900 1900`)

So, what if we take the sequence `0c0f82 00040301280100ff0000ff00` above and just replace `82` by `02` ? => It does actually set the color cycle effect.
We have always seen clearly see two colors here (the default green), so maybe they could be some effect parameters ?
Let's set E = 01 => It smoothly transitions the color to green ! So that would be the actual static color effect. (Different from the dynamic color we set with `080f03` ?)
If we change both `00ff00` to `ff0000` => We get a static red color. Looking good :)
If we change only the first color => It seems to change nothing.
(NB: A notable difference from setting the static color effect this way is that it transitions from the currently active color, as opposed to the dynamic color purely replacing the active color)
Interesting to note, however, that the response we get from `82` is `00040101280100ff0000ff00` and not `000401012801ff000000ff00`
So the reported colors are wrong (green despite red displayed ?)
By playing a bit with the stuff, it seems that using the values `0100` (from what Synapse was sending) instead of `0004` also works, but DO persist the effect ?
In that case, i would assume that the first byte is a boolean saying something like "persist setting" ?
Is persistance temporary for read-back, or is it permanent, though ? => Setting the colors to red and blue, and the static red color persists after off/on, while the blue color is also read back.
Still no clue what the second byte would be, but it is the value that is `04` for the mouse and `05` for the dock, so it might actually be best if we send `00` here instead ?
Seems that sending `00` as that second byte is actually working "as well" as `04`, so maybe that byte is unused or has another meaning ?
Also sending `05` does not seem to break ? => Actually the mouse was behaving weird after that (it did kinda break the effect restore after power up ?), but using `04` afterwards fixed it ?
Generally, it seems like sending some not-so-valid values as the second byte can break the persistance ?
I don't want to dig too far into this if I can get the basic stuff working. We just need to know if `0100` is enough or if we need `01mm` where `mm` is the "magic" byte of the device.
At least we know that `0100` allows read-back of the value even after restart => It does also seem to properly restore the state on power on after the `04` fix after the `05` mess up.
(Really wondering what purpose serves that value. Maybe some memory bank of some sort ? Let's clearly ignore this for now. 😄)
Setting E = 02 => It now seems to produce a configurable color pulse/breathing effect 🎉 (Instead of semi-random colors previously)
Now, there are clearly two colors in the data, and it is an effect that could make use of more than one color.
The `01` byte before the color sequence was set to `00` by synapse for the color cycle, which doesn't use any color, and we already knew from earlier tests that value 01 was supported.
This really seems like it could represent the number of colors used by the effect.
It seems that obviously, the static effect `01` isn't affected. (having a back-and-forth between two colors would have been kinda cool, though)
But for effect `02`, we actually get two alternating color pulses ! 🎉 The Red/Blue combo is was kinda nice to test with and detect this :)
Trying effect E = 00 again => It now clearly seems to be the real "disabled" effect. (Which would make sense)
This is probably a bit of a duplicate with setting the brightness to zero or the static color to black, but it can be easily persisted, so I guess this is good.
(I think the brightness is also auto-persisted ?)
Testing other effects:
Effect `08` does not seem to be the reactive effect… (Why did Synapse use that value).
However, lucked out by testing all effects again, and it seems that effect 05 seems to be the reactive effect. Only one color seems supported.
Effects 6 and 7 seem to be disallowed, as well as anything above 8 ?
The only one question remaining here would be: Can we have more than two configured colors for the pulse effect?

-- Continued from before the break

00 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
01 1f 000000 020084 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 020084 03 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

Tested: This is NOT the effect command

00 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 020004 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

Tested: This is NOT the effect command

00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
02 1f 000000 040087 02020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

00 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
02 1f 000000 040087 02020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

The 86/87 sequence repeats quite a few time as always…

00 1f 000000 01058a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e00
02 1f 000000 01058a 05 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b00

00 1f 000000 010580 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 010580 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

00 1f 000000 410581 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c500
02 1f 000000 020581 05 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

00 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 0e068e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 0e068e 00640005e0000005e0 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e200

00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 01058a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e00
02 1f 000000 01058a 05 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b00

00 1f 000000 010580 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 010580 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

00 1f 000000 410581 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c500
02 1f 000000 020581 05 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

00 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
01 1f 000000 040087 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
02 1f 000000 040087 020201 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

### Power Saving (Color Set to Static 00FF00)

00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

00 1f 000000 020703 003c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a00
01 1f 000000 020703 003c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003a00

00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

00 1f 000000 020703 012c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00
02 1f 000000 020703 012c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00

00 1f 000000 020703 0384 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
02 1f 000000 020703 0384 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100

00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

00 1f 000000 020703 012c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00
01 1f 000000 020703 012c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00
02 1f 000000 020703 012c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00

In the UI, this setting goes from 1 to 15 minutes.
The command seems less trivial than low power mode, but by looking at the values, they seem to be multiples of 60.
So the value is actually two bytes in big-endian that represent a number of seconds of inactivity before power saving mode is enabled.

### Low Power Mode (Color Set to Static 00FF00)

00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00
00 1f 000000 010701 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00
02 1f 000000 010701 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00

00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

00 1f 000000 010701 0f 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800
01 1f 000000 010701 0f 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800
02 1f 000000 010701 0f 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800

00 1f 000000 010701 ea 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ed00
01 1f 000000 010701 ea 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ed00
02 1f 000000 010701 ea 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ed00

00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

00 1f 000000 010701 70 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007700
01 1f 000000 010701 70 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007700
02 1f 000000 010701 70 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007700

00 1f 000000 010701 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00
02 1f 000000 010701 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00
00 1f 000000 080f03 0000000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

The command is quite easy to understand here, as it seems to take a single byte (unlike Power Saving ?).
Similar to brightness, the value is expressed from 0% to 100% in the UI, but from 0 to 255 in the commands.
e.g. The last iteration has byte `0C`, which was obtained by setting low power mode back to 5 minutes. 100*12/255 = 4.70, which is close to 5.

### Brightness

00 1f 000000 030f04 01 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f600
01 1f 000000 030f04 01 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f600
02 1f 000000 030f04 01 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f600

00 1f 000000 030f04 01 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f600
01 1f 000000 030f04 01 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f600
02 1f 000000 030f04 01 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f600

00 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
01 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

We already saw that one previously. The value is expressed as a single byte from 0 to 255 representing a percentage from 0% to 100%.
The byte always set to 1 could be the enable/disable flag.

### Brightness enable/disable

Nothing interesting here, it seems that enabling/disabling brightness is simply a matter of setting it to zero or not zero with the same command as above.

00 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
01 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
01 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00
01 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00
02 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00

00 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00
02 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00

00 1f 000000 080f03 00 00000000 00ff00 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

00 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 00 00 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00
02 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00

00 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00
01 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00
02 1f 000000 030f04 01 00 54 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005d00

NB: It seems than manual color adjustments (`08 0f 03`) preceding a brightness adjustment could return their own (success) response instead of the one of brightness adjustments (`03 0f 04`).
This was actually causing bugs with the first implementation for `DisabledColorEffect`, but I noticed the exact same problem in dumps from Synapse 3.
We have to assume this is an expected behavior, and as such, brightness adjustments should be retried at least once if they fail.
The possible good implementation would be to throw a special exception in order to report that there was a command mismatch in the success response. (So that it is not mistaken with an actual error)

### Battery level check ?

I've done this when the battery level was 100%, so we expect a value.
Most reports produce a response identical to the request, so we are looking for a request which has a different response, and that includes a number close to 255 (or exactly 255).
Reason being that Razer actually seem to express percentages from 0 to 255 in all cases.
NB: A quick way to find actually meaningful command responses is to check for the checksum byte. Since the two initial bytes are not part of the checksum computation, responses not providing
meaningful results (or at least interpretable results from our POV), will have exactly the same checksum value as the request.

To do this, I disabled the brightness (which actually stops synapse software from sending periodic color updates) and waited for an expected check of brightness for the software.
This generated a few results, among which one was quite interesting.

00 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
01 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
02 1f 000000 020780 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a00

We can see in the above output that the byte `FF` was returned, which, I hope, should represent the battery level at 100%.

### Idle checks done by Synapse (the mouse was sometimes moved to bring it back alive), including the above

00 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
02 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100

00 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
02 1f 000000 020780 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a00
Battery status ?

00 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
02 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

00 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
02 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100

00 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
01 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
02 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100

00 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
01 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
02 1f 000000 020780 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a00

Confirmed to be battery status (Also confirmed to not contain external power status. The `00` is always `00` from what I've observed. Mouse wired or connected to the dock doesn't change)
Now that I've also confidently determined that all calls with the pattern "xxxx8x" are reads (it is probably only a single bit indicating read/write, as there are also values such as "bb")
And also confirmed that the device do send external power notifications…
I'm quite wondering if the `020784` command sent before the battery check would be a way to manually read that information. (Because I need that information for consistency)
It also seems that the second byte is some kind of feature group (similar to HID++ features), and the third bit would be a function ID or some kind of register.
Looking at the power-related examples above (low power mode and power saving), they all have `07` as a second byte. And RGB stuff all had `0f` there.
Worst case, we should be able to send "read" calls to all values hoping it doesn't destroy the device, in order to find the info we need?
The command `020784` seems to return `00 01` when the mouse is docked (contrary to the `00 00` above), so it seems to match expectations 🎉

001f00000002078000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
021f00000002078000ff0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a00

001f0000000100bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
011f0000000100bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
021f0000000100bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

001f0000000100bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
011f0000000100bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
021f0000000100bb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

(Mouse went offline and was moved here)

001f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
011f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
021f00000004008702020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

000800000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
020800000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

001f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
011f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
021f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

001f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
021f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

001f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
011f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
021f00000004008702020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

001f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
011f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
021f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

001f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
021f00000004008702020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

001f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
011f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
021f00000002008600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

001f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
011f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300
021f00000004008702020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

And so on… It follows the same pattern than on startup, so I'm not going to repeat that here
What would be interesting is to capture the event that is sent when the mouse wakes up.
It **cannot** be through the custom Razer protocol because this one only works through Feature reports, which are not interactive. (Unlike input/output reports that are for example used by HID++)

But after a while, we do get different reports:

00 1f 000000 060f02 00 00 08 00 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200
01 1f 000000 060f02 00 00 08 00 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200
02 1f 000000 060f02 00 00 08 00 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200

00 1f 000000 080f03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 060f02 00 00 08 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
01 1f 000000 060f02 00 00 08 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300
02 1f 000000 060f02 00 00 08 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000300

00 1f 000000 080f03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 020703 01 2c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00
01 1f 000000 020703 01 2c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00
02 1f 000000 020703 01 2c 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002b00

00 1f 000000 010701 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00
01 1f 000000 010701 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00
02 1f 000000 010701 0c 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000b00

00 1f 000000 080f03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 030b03 00 04 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00
02 1f 000000 030b03 00 04 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00

00 1f 000000 030b03 00 04 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00
01 1f 000000 030b03 00 04 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00
02 1f 000000 030b03 00 04 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f00

00 1f 000000 040b0b 00 04 01 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01 1f 000000 040b0b 00 04 01 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01 1f 000000 040b0b 00 04 01 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01 1f 000000 040b0b 00 04 01 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
02 1f 000000 040b0b 00 04 01 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

This one is **very** interesting, because we see multiple (identical) `01` responses.
I'm assuming that the algorithm must be something like: "fetch responses until you get a `02` response", but I have no good interpretation on the specific meaning of such responses.
Should the `01` responses always be ignored ?

00 1f 000000 080f03 00 00 00 00 00 00 03 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700

00 1f 000000 010005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 010005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 070405 00 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 070405 00 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 070405 00 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

00 1f 000000 070405 00 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 070405 00 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 070405 00 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

00 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
01 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 01058a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e00
02 1f 000000 01058a 05 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b00

00 1f 000000 01058a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008e00
02 1f 000000 01058a 05 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008b00

00 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
01 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
02 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100

00 1f 000000 010580 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 010580 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

00 1f 000000 010580 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 010580 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500

00 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
01 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
02 1f 000000 020780 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a00

00 1f 000000 410581 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c500
02 1f 000000 020581 05 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

00 1f 000000 410581 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c500
02 1f 000000 020581 05 01 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200

00 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
02 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

00 1f 000000 0e068e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 0e068e 00640005e0000005e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e200

00 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
02 1f 000000 020680 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

00 1f 000000 010502 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700
02 1f 000000 010502 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700

00 1f 000000 0e068e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008600
02 1f 000000 0e068e 00640005e0000005e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000e200

00 1f 000000 260406 01 05 05 00 0190 0190 0000 01 0320 0320 0000 02 0640 0640 0000 03 0c80 0c80 0000 04 1900 1900 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000002100
02 1f 000000 260406 01 05 05 00 0190 0190 0000 01 0320 0320 0000 02 0640 0640 0000 03 0c80 0c80 0000 04 1900 1900 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000002100

This one command seems quite different from the others, so it should have a very specific meaning. Maybe the software transferring "profile" data to the mouse ?

We can observe some repeated sequences here that form "non-random" numbers:
0x0190 is 400
0x0320 is 800
0x0640 is 1600
0x0c80 is 3200
0x1900 is 6400
These are very clearly DPI settings. (I left mine unchanged so these are the actual values)

I'm unsure why the values are repeated in the message, but it clearly includes a pattern of  `<Index:U8> <DPI_Value:U16> <DPI_Value:U16>` where values are big-endian, and index is zero-based.

=> In fact, in the Synapse UI there is a "Enable X-Y" setting, so this is definitely X and Y DPI settings here.

The two `05` at the beginning would be the number of DPI settings (I believe 5 is the maximum number of settings ?)
The mouse has only a single profile for now, but could it be possible that the `01` at the beginning is the profile ID ? (First profile)

00 1f 000000 070405 01 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700
02 1f 000000 070405 01 1900 1900 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000700

Again here, 0x1900 is 6400 and repeated two times like in the command before, so this command could also be DPI related.
The response is identical to the request, though. Is it to set the current DPI ?

00 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
01 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 030f04 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 010005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 010005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 01 00 01 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 0a020c 01 01 00 01 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 02 00 01 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 0a020c 01 02 00 01 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 03 00 01 01 03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 0a020c 01 03 00 01 01 03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 0b 00 06 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800
02 1f 000000 0a020c 01 0b 00 06 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800

00 1f 000000 0a020c 01 0c 00 06 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00
02 1f 000000 0a020c 01 0c 00 06 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00

00 1f 000000 0a020c 01 0e 00 07 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 0a020c 01 0e 00 07 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 0a020c 01 09 00 01 01 09 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 0a020c 01 09 00 01 01 09 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 0a 00 01 01 0a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 0a020c 01 0a 00 01 01 0a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 04 00 01 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 0a020c 01 04 00 01 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 05 00 01 01 05 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 0a020c 01 05 00 01 01 05 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 0a020c 01 01 01 01 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
02 1f 000000 0a020c 01 01 01 01 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 0a020c 01 02 01 01 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
02 1f 000000 0a020c 01 02 01 01 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 0a020c 01 03 01 01 01 03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
02 1f 000000 0a020c 01 03 01 01 01 03 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 0a020c 01 0b 01 06 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900
02 1f 000000 0a020c 01 0b 01 06 01 01 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000900

00 1f 000000 0a020c 01 0c 01 06 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d00
02 1f 000000 0a020c 01 0c 01 06 01 02 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d00

00 1f 000000 0a020c 01 0e 01 07 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800
02 1f 000000 0a020c 01 0e 01 07 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800

00 1f 000000 0a020c 01 09 01 01 01 09 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
02 1f 000000 0a020c 01 09 01 01 01 09 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 0a020c 01 0a 01 01 01 0a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
02 1f 000000 0a020c 01 0a 01 01 01 0a 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 0a020c 01 04 01 01 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
02 1f 000000 0a020c 01 04 01 01 01 04 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

00 1f 000000 0a020c 01 05 01 01 01 05 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400
02 1f 000000 0a020c 01 05 01 01 01 05 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400

The above commands clearly look like some specific settings but I can't make sense of them for now.
It could be some profile data such as button mapping?

00 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
01 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
02 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100

00 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
01 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
02 1f 000000 020780 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a00

00 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
02 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

00 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
01 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100
02 1f 000000 020784 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008100

00 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
01 1f 000000 020780 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008500
02 1f 000000 020780 00 ff 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000007a00

00 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00
02 1f 000000 0100bb 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

### Polling Frequency

00 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

00 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

00 1f 000000 01 0005 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00
01 1f 000000 01 0005 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00
02 1f 000000 01 0005 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00

00 1f 000000 01 0005 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00
01 1f 000000 01 0005 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00
02 1f 000000 01 0005 08 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c00

00 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

00 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
01 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600
02 1f 000000 01 0005 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000600

00 1f 000000 01 0005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 01 0005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

00 1f 000000 01 0005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
01 1f 000000 01 0005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500
02 1f 000000 01 0005 01 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500

Playing with the different polling frequencies in Synapse 3 here: 1000, 500 and 125.
We see the value changing to 2 (500), 8 (125) and back to 1.

# Standard Lighting API ??

By manually analyzing the numerous HID reports returned by the mouse, it would seem that it implements the standard HID lighting controls on device interfaces 3 and 4…
This could be a viable alternative to the Razer custom protocol.
However, there are two things regarding this:

 * If it works (would need to be verified), we need to implement a generic way to handle standard Lighting & Illumination collections, and probably deal with the Windows flavor of parsed HID descriptors.
 * We likely still want to have the Razer protocol working because it would allow editing mouse profiles & getting battery info.
 * These two interfaces would be the ones that constantly error out when scanning the devices using DeviceTools.Cli. This predates the installation of Synapse 3. 
 
Maybe Windows is reserving these collections for itself with their upcoming RGB lighting feature ?
=> Seems to be the case. As explained here, the new API allows automatic control of all HID devices compliant with the new HID Lighting & Illumination page: https://learn.microsoft.com/en-us/windows/uwp/devices-sensors/lighting-dynamic-lamparray
While not said explicitly in the docs, it seems that going through the API will be mandatory to access these devices, so no raw access.
This is kind of a good thing, as we could be able to rely on this (and will need to do so for some future devices), and it avoids the necessity for parsing HID reports.
However, the documentation implies that lighting control would only be available in **applications**, which would be a problem.
It also says that **applications** need to register as a lighting controller in order to control lights in the background, which we'll need to do.
If possible I'd like to avoid relying on WinRT APIs and find lower level APIs such as DevQuery* C APIs to control these features.
I'll try digging in the Windows SDK headers and see if I find anything of use. In the meantime, let's wait for the official feature to roll out.
(To be fair I'm half happy and half sad about it. It should be a good thing in general, but will make a lot of the work here redundant 🙁)

Interface 3:

HID Report
	Usage Page (Lighting and Illumination)
	Usage (LampArray)
	Collection (Application)
		Header
		Collection type: Application (0x01)
		Report ID (0x01)
		Usage (LampArrayAttributesReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampCount)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (1)
			Feature (Const,Var,Abs)
			Usage (BoundingBoxWidthInMicrometers)
			Usage (BoundingBoxHeightInMicrometers)
			Usage (BoundingBoxDepthInMicrometers)
			Usage (LampArrayKind)
			Usage (MinUpdateIntervalInMicroseconds)
			Logical Minimum (0)
			Logical Maximum (2147483647)
			Report Size (32)
			Report Count (5)
			Feature (Const,Var,Abs)
			End Collection
		Report ID (0x02)
		Usage (LampAttributesRequestReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampId)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (1)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x03)
		Usage (LampAttributesResponseReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampId)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (1)
			Feature (Data,Var,Abs)
			Usage (PositionXInMicrometers)
			Usage (PositionYInMicrometers)
			Usage (PositionZInMicrometers)
			Usage (UpdateLatencyInMicroseconds)
			Usage (LampPurposes)
			Logical Minimum (0)
			Logical Maximum (2147483647)
			Report Size (32)
			Report Count (5)
			Feature (Data,Var,Abs)
			Usage (RedLevelCount)
			Usage (GreenLevelCount)
			Usage (BlueLevelCount)
			Usage (IsProgrammable)
			Usage (InputBinding)
			Logical Minimum (0)
			Logical Maximum (255)
			Report Size (8)
			Report Count (5)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x04)
		Usage (LampMultiUpdateReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampCount)
			Usage (LampUpdateFlags)
			Logical Minimum (0)
			Logical Maximum (8)
			Report Size (8)
			Report Count (2)
			Feature (Data,Var,Abs)
			Usage (LampId)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (8)
			Feature (Data,Var,Abs)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Logical Minimum (0)
			Logical Maximum (255)
			Report Size (8)
			Report Count (24)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x05)
		Usage (LampRangeUpdateReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampUpdateFlags)
			Logical Minimum (0)
			Logical Maximum (8)
			Report Size (8)
			Report Count (1)
			Feature (Data,Var,Abs)
			Usage (LampIdStart)
			Usage (LampIdEnd)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (2)
			Feature (Data,Var,Abs)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Logical Minimum (0)
			Logical Maximum (255)
			Report Size (8)
			Report Count (3)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x06)
		Usage (LampArrayControlReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (AutonomousMode)
			Logical Minimum (0)
			Logical Maximum (1)
			Report Size (8)
			Report Count (1)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x07)
		Usage Page (Vendor)
		Logical Minimum (0)
		Logical Maximum (255)
		Usage (Vendor)
		Report Size (8)
		Report Count (63)
		Feature (Data,Var,Abs)
		End Collection
	Usage Page (Consumer)
	Usage (Consumer Control)
	Collection (Application)
		Header
		Collection type: Application (0x01)
		Report ID (0x08)
		Usage Minimum (0xd0)
		Usage Maximum (0xd7)
		Logical Minimum (0)
		Logical Maximum (1)
		Report Size (1)
		Report Count (8)
		Input (Data,Var,Abs)
		End Collection

Interface 4:

HID Report
	Usage Page (Lighting and Illumination)
	Usage (LampArray)
	Collection (Application)
		Header
		Collection type: Application (0x01)
		Report ID (0x01)
		Usage (LampArrayAttributesReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampCount)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (1)
			Feature (Const,Var,Abs)
			Usage (BoundingBoxWidthInMicrometers)
			Usage (BoundingBoxHeightInMicrometers)
			Usage (BoundingBoxDepthInMicrometers)
			Usage (LampArrayKind)
			Usage (MinUpdateIntervalInMicroseconds)
			Logical Minimum (0)
			Logical Maximum (2147483647)
			Report Size (32)
			Report Count (5)
			Feature (Const,Var,Abs)
			End Collection
		Report ID (0x02)
		Usage (LampAttributesRequestReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampId)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (1)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x03)
		Usage (LampAttributesResponseReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampId)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (1)
			Feature (Data,Var,Abs)
			Usage (PositionXInMicrometers)
			Usage (PositionYInMicrometers)
			Usage (PositionZInMicrometers)
			Usage (UpdateLatencyInMicroseconds)
			Usage (LampPurposes)
			Logical Minimum (0)
			Logical Maximum (2147483647)
			Report Size (32)
			Report Count (5)
			Feature (Data,Var,Abs)
			Usage (RedLevelCount)
			Usage (GreenLevelCount)
			Usage (BlueLevelCount)
			Usage (IsProgrammable)
			Usage (InputBinding)
			Logical Minimum (0)
			Logical Maximum (255)
			Report Size (8)
			Report Count (5)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x04)
		Usage (LampMultiUpdateReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampCount)
			Usage (LampUpdateFlags)
			Logical Minimum (0)
			Logical Maximum (8)
			Report Size (8)
			Report Count (2)
			Feature (Data,Var,Abs)
			Usage (LampId)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (8)
			Feature (Data,Var,Abs)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Logical Minimum (0)
			Logical Maximum (255)
			Report Size (8)
			Report Count (24)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x05)
		Usage (LampRangeUpdateReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (LampUpdateFlags)
			Logical Minimum (0)
			Logical Maximum (8)
			Report Size (8)
			Report Count (1)
			Feature (Data,Var,Abs)
			Usage (LampIdStart)
			Usage (LampIdEnd)
			Logical Minimum (0)
			Logical Maximum (65535)
			Report Size (16)
			Report Count (2)
			Feature (Data,Var,Abs)
			Usage (RedUpdateChannel)
			Usage (GreenUpdateChannel)
			Usage (BlueUpdateChannel)
			Logical Minimum (0)
			Logical Maximum (255)
			Report Size (8)
			Report Count (3)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x06)
		Usage (LampArrayControlReport)
		Collection (Logical)
			Header
			Collection type: Logical (0x02)
			Usage (AutonomousMode)
			Logical Minimum (0)
			Logical Maximum (1)
			Report Size (8)
			Report Count (1)
			Feature (Data,Var,Abs)
			End Collection
		Report ID (0x07)
		Usage Page (Vendor)
		Logical Minimum (0)
		Logical Maximum (255)
		Usage (Vendor)
		Report Size (8)
		Report Count (63)
		Feature (Data,Var,Abs)
		End Collection

# Calling the device through razer drivers

Provided we install the drivers on our computer without synapse, is should be possible to access the Razer protocol features without actually relying on Synapse software.
Regarding this, the question of how to get our hands on the drivers remain.
Installing Synapse 3 to get the drivers for the device installed on the disk is a solution that works, but not one that is flexible.
Synapse 3 will only (download ?) & install drivers for the devices that are required, which is a wise choice. (It is a feature I thought about for a much later version Exo, so I can't blame them :))
It will have to do for now, though. (I'm assuming it would be possible to manually download those from their servers, but I'm unsure this is acceptable)

From what I can see, the drivers do, as I suspected, provide a way to bypass the standard Windows HID stack and emit or receive HID reports that Windows would deem invalid.

Thankfully, they do this in a quite simple way, by exposing a custom Get/Set Feature Report as IO Control Codes.

For the Dock, I got the following IO Control codes:

SetFeature: 0x88883010
GetFeature: 0x88883014

The calls are as straightforward as they get. No shenanigans here.
I'm assuming these are 100% compatible with the standard Widows HidD_SetFeature / HidD_GetFeature, meaning that they would include the Report ID byte. If not, it will be easy to detect.

I still don't know if these IO control codes are universal, and on which device interface they should be used.
It is possible they work on all device interfaces, but I doubt their software would open one at random.

I'm assuming the SetFeature/GetFeature stuff is quite universal across drivers for this generation of hardware, as I have a hard time imagining Razer writing 100% custom drivers for each and every device.
It is however possible that their build system would generate drivers for each device with slightly different parameters and use different IoControl codes just for the sake of doing it.
(That's actually what I would do if I wanted to make my stuff hard to interoperate with, as they seemingly did here by hiding their features from Windows user mode)

As for the device to open, it would seem that the drivers create device notes under the following custom device class GUID: e3be005d-d130-4910-88ff-09ae02f680e9
Those devices would generally have a name like those:

 \\?\RZCONTROL#VID_1532&PID_007D&MI_00#a&1ddbaa2e&0#{e3be005d-d130-4910-88ff-09ae02f680e9}
 \\?\RZCONTROL#VID_1532&PID_007E&MI_00#a&33f42eb&0#{e3be005d-d130-4910-88ff-09ae02f680e9}

Aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaannnnd… It works !

Just sending that one command to the dock device is enough to change its color:

00001f000000080f030000000000ea1134000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000cb00

And just to be sure, the same command manually adjusted for generating to green (00FF00) works:

00001f000000080f03000000000000ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000fb00

It does seem to immediately switch the dock to "static color" at the same time, so there is definitely something more to do here, but having this working is definitely great news.
Having to deal with the razer custom drivers is certainly less than ideal, but at least it is easy to work with in that case.

# Availability notifications of the mouse connected to a dongle

# Initial observations

From looking at the captured packets in Wireshark from a long capture sequence, it seems that the packets produced are URB IN on endpoint 2.
Endpoint 2 is Device Interface 01 (MI_01 in Windows).
If I interpret the data correctly, the first byte of these 16 bytes-long packets should be the report ID.
We get one packet with the report ID 2, and two packets with the report ID 5 before the SET Feature from Synapse.
From the raw HID descriptors (because I really can't make any sense of the gibberish returned by Windows preparsed data 😥), it seems that those two reports are indeed 15 byte long.
Report ID 02 would contain some form of structured information, while report ID 05 is clearly composed of 15 raw bytes. (Which doesn't mean that there is no meaning to these)

## HID Descriptor of Device Interface 1

Below is the whole HID descriptor for interface 01, as obtained in Wireshark:

````
Usage Page (Generic Desktop Controls)
Usage (Keyboard)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x01)
	Usage Page (Keyboard/Keypad)
	Usage Minimum (0xe0)
	Usage Maximum (0xe7)
	Logical Minimum (0)
	Logical Maximum (1)
	Report Size (1)
	Report Count (8)
	Input (Data,Var,Abs)
	Usage Minimum (0x00)
	Usage Maximum (0xff)
	Logical Minimum (0)
	Logical Maximum (255)
	Report Size (8)
	Report Count (14)
	Input (Data,Array,Abs)
	Usage Page (LED)
	Usage Minimum (0x01)
	Usage Maximum (0x03)
	Logical Minimum (0)
	Logical Maximum (1)
	Report Size (1)
	Report Count (3)
	Output (Data,Var,Abs)
	Report Count (5)
	Output (Const,Array,Abs)
	End Collection
Usage Page (Generic Desktop Controls)
Usage (Mouse)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x0a)
	Usage (Pointer)
	Collection (Physical)
	End Collection
Usage Page (Consumer)
Usage (Consumer Control)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x02)
	Usage Minimum (0x00)
	Usage Maximum (0x23c)
	Logical Minimum (0)
	Logical Maximum (572)
	Report Count (1)
	Report Size (16)
	Input (Data,Array,Abs)
	Report Size (8)
	Report Count (13)
	Input (Const,Array,Abs)
	End Collection
Usage Page (Generic Desktop Controls)
Usage (System Control)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x03)
	Usage Minimum (0x81)
	Usage Maximum (0x83)
	Logical Minimum (0)
	Logical Maximum (1)
	Report Size (1)
	Report Count (3)
	Input (Data,Var,Abs)
	Report Count (5)
	Input (Const,Array,Abs)
	Report Size (8)
	Report Count (14)
	Input (Const,Array,Abs)
	End Collection
Usage Page (Generic Desktop Controls)
Usage (Undefined)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x04)
	Usage (Reserved)
	Logical Minimum (0)
	Logical Maximum (255)
	Physical Minimum (0)
	Physical Maximum (255)
	Report Size (8)
	Report Count (15)
	Input (Data,Array,Abs)
	End Collection
Usage Page (Generic Desktop Controls)
Usage (Undefined)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x05)
	Usage (Reserved)
	Logical Minimum (0)
	Logical Maximum (255)
	Physical Minimum (0)
	Physical Maximum (255)
	Report Size (8)
	Report Count (15)
	Input (Data,Array,Abs)
	End Collection
Usage Page (Generic Desktop Controls)
Usage (Undefined)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x08)
	Usage (Reserved)
	Logical Minimum (0)
	Logical Maximum (255)
	Physical Minimum (0)
	Physical Maximum (255)
	Report Size (8)
	Report Count (15)
	Input (Data,Array,Abs)
	End Collection
Usage Page (Generic Desktop Controls)
Usage (Undefined)
Collection (Application)
	Header
	Collection type: Application (0x01)
	Report ID (0x09)
	Usage (Reserved)
	Logical Minimum (0)
	Logical Maximum (255)
	Physical Minimum (0)
	Physical Maximum (255)
	Report Size (8)
	Report Count (15)
	Input (Data,Array,Abs)
	End Collection
````

As we can see above, there are quite a few reports that are defined to have 15 bytes of raw data.
These are reports with IDs `04`, `05`, `08` and `09`. Role of reports other than `05` is currently unknown. (Need to check earlier captures during the installation of Synapse for possible signs of those)

By taking another capture, the role of report `02` might only be distantly related, as one report was received before the device disconnected, but those reports are always empty ?

Report `05` seems to clearly be an indicator of activity of the mouse. A report ID `05` is also present in the dock (Need to check the HID descriptor to see if it is the same) so it must have a generic prupose.

All these report are Input Reports, meaning that they only serve to receive notifications from the device, and not the other way around.

## Mouse sleeping down

The notifications received when the device is going to sleep are the following:

Endpoint 1 (Interface 0): `0000000000000000` (Likely the mouse report)

Endpoint 2 (Interface 1): `02000000000000000000000000000000`

Endpoint 2 (Interface 1): `05090201000000000000000000000000`

## Mouse waking up

Then, if the device wakes up, we observe the following:

### Sequence 1 (By moving the mouse)

Endpoint 2 (Interface 1): `05090301000000000000000000000000` 

SET Feature: `001f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300`

Endpoint 1 (Interface 0): `0000000000000000`

Endpoint 2 (Interface 1): `05021900190000000000000000000000`

Endpoint 1 (Interface 0): `00000000ffff0000` (Definitely the mouse report)

GET Feature: `011f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300`

### Sequence 2 (By clicking without moving the mouse)

Endpoint 2 (Interface 1): `05090301000000000000000000000000`

SET Feature: `001f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300`

GET Feature: `011f00000004008700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008300`

Endpoint 1 (Interface 0): `0100000000000000`

Endpoint 2 (Interface 1): `05021900190000000000000000000000`

GET Feature: `021f00000004008702020100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008200`

Endpoint 1 (Interface 0): `0000000000000000`

## Analysis

It seems the empty messages generated on Interface 00 / Report ID 00 and Interface 01 / Report ID 02, are sent to make sure that the state is cleared (e.g. do not leave a click state lingering)

We could obviously ignore the mouse reports, but it means we probably also can disregard the Report ID 02 on Interface 1.

This leaves only report ID 05 on Interface 1.

In case of going to sleep, a single message is emitted: `090201000000000000000000000000`

In case of waking up there are two messages:

`090301000000000000000000000000`
`021900190000000000000000000000`

We can see that Synapse 3 reacts immediately, to the first message, which is shortly followed by the second message.
It is yet unknown if the second message is a consequence of Synapse reacting to the first.

Comparing the sleep/wake initial messages, there seem to be a pattern:

SLEEP : 09 02 01 000000000000000000000000
WAKE  : 09 03 01 000000000000000000000000

It seems relatively safe to assume that `09` indicates a device availability notification.
The second byte could be the availability status kind, and the third byte could be the device index ? (Assuming there could be dongles supporting multiple devices like Logitech Unifying/Bolt)

The second notification is also sent when the device is connected wired. (But you'd need to be pretty quick to catch it with software, I guess ?)
As it contains the sequence 0x1900, repeated two times, it is probably DPI related like some commands in the protocol:

02 1900 1900 00000000000000000000
   DPIX DPIY

There is no information that could be a device index here, however.

We can sometimes observe a notification starting with ID `0c`. As the parameters were empty, the meaning was not really obvious, but I noticed that when puttin the mouse on the dock for charging,
that same command was emitted as `0c01`. So I guess that's that 😁

## Operations when the device is not connected

If we start the service with the device disconnected from the dongle, the responses start with `04`:

00 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
04 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
04 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
04 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
04 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400
04 08 000000 020086 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008400

It seems that responses starting with `04` indicate an error. Anyway, in our case, it indicates that the device is not available.
When the response is `04`, the service seems to retry reading a response four additional times. (So a total of 5 GetFeature)

Ability to communicate with the dongle itself seems limited, but there is at least one request that produces a result.

00 08 000000 3100bf 02 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008c00
02 08 000000 3100bf 02 00 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f100

So, we should assume that this request directly queries the dongle.
We can look for difference in responses between when the mouse is connected and not connected.

OFFLINE : 02 08 000000 3100bf 02 00 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f100
ONLINE  : 02 08 000000 3100bf 02 01 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000

Apparently, the only difference is in the byte that is set to 01.

Possibly, the first useful byte in the response set to `02` could indicate that this dongle can bind to two devices ?
If that's the case, the two sets of three bytes could be one for each device.
However… The `7d` above seems to match the dongle PID of `007D`, and it is probably not a coincidence. (Need to check that PID thing because we know that when wired, the mouse has PID 007C)

Actually, by checking the documentation, that dongle does support up to two devices? https://mysupport.razer.com/app/answers/detail/a_id/4048/~/how-to-add-a-device-to-a-multi-device-dongle

And I can open the pairing utility in the Synapse 3 UI as shown in the website.

When opening the pairing utility, we get the following requests:

00 1f 000000 0300c5 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c600
02 1f 000000 0300c5 01 007d 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

00 1f 000000 3100bf 10 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009e00
02 1f 000000 3100bf 02 01 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000

00 1f 000000 3100bf 10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009e00
02 1f 000000 3100bf 02 01 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000

00 1f 000000 0300c5 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c600
02 1f 000000 0300c5 01 007d 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

00 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00
02 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00

00 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00
02 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00

00 1f 000000 3100bf 10 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009e00
02 1f 000000 3100bf 02 01 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000

00 1f 000000 3100bf 10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009e00
02 1f 000000 3100bf 02 01 007d 00 ffff 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000f000

00 1f 000000 0300c5 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c600
02 1f 000000 0300c5 01 007d 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

00 1f 000000 0300c5 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000c600
02 1f 000000 0300c5 01 007d 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ba00

00 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00
02 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00

00 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00
02 1f 000000 0300bc 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bf00

Maybe that 1f is related to the device ID ?
I can't really make sense of that byte, but I only observed values `08` and `1f`.
It seems like it could be similar to the device index of the HID++ protocol where you have to use `FF` for the dongle, `01` for the first device, and so on…
It would be wise to assume that `1f` speaks to the first device, and `08` speaks to the connected dongle, but it still wouldn't explain everything.
These values could be more like bit masks, but if so, more sample data is needed.

# Accessing the device via bluetooth 

Understanding the working of the device under bluetooth is a bit more complicated, as it is not possible to directly capture HID exchanges done through bluetooth.
It is however possible to observe the bluetooth frames wrapped in USB by USB bluetooth adapters, but that may only tell part of the story, as HID is likely to work slightly differently with bluetooth.

It is possible that the command are split in multiple packets or that the protocol takes a different format over BLE.

This is likely the command or a bit of the command to define the lighting effect, captured from a packet
02 00 28 02 ff00ff 00ffff

This is kinda weird as some of the packets seem to include part of the S/N of the device. There could be an internal buffer of some kind.
Anyway, Wireshark is not especially helpful in that case, as even regular notifications (the one for device status ans such) show up in these packets without much added details.
For all bluetooth notifications, it shows "Handle unknown" in the BT Attribute protocol, even for those that are not Razer-specific.

Found the S/N packet, but in only contains the whole serial number:
504dxxxxxxxxxxxxxxxxxxxxxxxxxx0000000000
"PM…"

This was received with the handle 003f, as most of these notifications. Most writes seem to use the handle 003d. I can't make any sense of this for now.

It seems that transactions can be observed in real time using Microsoft Bluetooth LE Explorer.

Service Name: 52401523-f97c-7f90-0e7f-6c6f4e36db1c
52401524-f97c-7f90-0e7f-6c6f4e36db1c Handle 60 (3C) => 8 bytes, maybe this contains the command stuff
52401525-f97c-7f90-0e7f-6c6f4e36db1c Handle 62 (3E) => It seems this is the buffer receiving protocol responses ? It could have a constant length of 20 bytes
52401526-f97c-7f90-0e7f-6c6f4e36db1c Handle 65 (41) => ??

Is it possible that in this case we don't need the Razer driver to access the device ?
Possibly everything is exposed through GATT services somehow. It is however weird how there is still a specific driver installed for the device.
Need to read how all this BT stuff works 😩

Looking a bit a the captured data again, and it seems that we do see the entire serial number in one response packet with handle 003f. (Serial Number starting at offset 0)
However, it is still unclear how the request is sent. (NB: Packet 1101 in my capture)

By analysing the packets in a bit more detail, it seems that the characteristic 52401525-f97c-7f90-0e7f-6c6f4e36db1c is used to receive data from requests written to 52401524-f97c-7f90-0e7f-6c6f4e36db1c.
It seems that responses are received in multiple packets, with the first one simply indicating the data length.

Sequence to retrieve the serial number:

=> 8300000001830000
<= 831600000000000XXXXXXXXXXXXXXXXXXXXXXXXX
<= XXXXXXXXXXXXXXXXXXXXXXXXXXXXXX0000000000
<= 0000XXXXXXXXXXXXXXXXXXXXXXXXXX0000000000

As can be seen, the second byte of the first response packet indicates 22.
A data packet contains 20 bytes, and we can see the third packet containing two zero bytes at the begining.

By sending the same command within "Bluetooth LE Lab", we can actually see the last two packets come up as notification, but for some reason not the first ones. (Might be a bug of the tool ?)
This at least proves that we can retrieve the device serial number from bluetooth, and is a step in the right direction towards understanding the protocol.

Seems like the first byte of the command could be the command ID, as it is replicated in the response.
However, we see `83` two times in the request message above, but in other request messages, the two numbers are not always exactly the same (e.g. `87` and `86`)

Another command sent just earlier:

=> 8700000001860000
<= 870300000000000XXXXXXXXXXXXXXXXXXXXXXXXX
<= 000000000000000XXXXXXXXXXXXXXXXXXXXXXXXX

No idea what this one does, as it simply returns zero.


There are also responses to writes to another handle (40 in the capture), not sure what it could be. (Seems like there could be hidden/undocumented characteristics on the device, but maybe I'm misinterpreting)

Other (following) requests:

8700000001860000
870300000000000XXXXXXXXXXXXXXX0000000000
000000000000000XXXXXXXXXXXXXXX0000000000

8100000000810000
810400000000000XXXXXXXXXXXXXXX0000000000
020201000000000XXXXXXXXXXXXXXX0000000000

(Might be FW version ?)



04000000006d006d
140000000000000XXXXXXXXXXXXXXX0000000000

(packet 1737)
=> 0302000001020000
=> 0300
<= 030000000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005850001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005810001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= ff0100000000000XXXXXXXXXXXXXXX0000000000
=> 9100000001900000
<= 910100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005850001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005850001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005810001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= ff0100000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005810001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= ff0100000000000XXXXXXXXXXXXXXX0000000000
=> 9100000001900000
<= 910100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 9100000001900000
<= 910100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005850001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 8500000005810001
<= 850100000000000XXXXXXXXXXXXXXX0000000000
<= ff0100000000000XXXXXXXXXXXXXXX0000000000
=> 9100000001900000
<= 910100000000000XXXXXXXXXXXXXXX0000000000
<= 000100000000000XXXXXXXXXXXXXXX0000000000
=> 8700000001860000
<= 870300000000000XXXXXXXXXXXXXXX0000000000
<= 000000000000000XXXXXXXXXXXXXXX0000000000
=> 130a000010030000
<= 08000000000000000000
<= 130000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000000000
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 130a000010030000
=> 08000000000000000000
<= 130000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000000000
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 0502000005040000
=> 2c01
<= 050000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000000000
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 0701000005020001
=> 0c
<= 070000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000000000
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 0b0600000b010000
=> 001900190000
<= 0b0000000000000XXXXXXXXXXXXXXX0000000000
=> 0f010000050b0100
=> 02
<= 0f0000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000020002
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 1501000010050100
=> 54
<= 150000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000180018
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 8700000001860000
<= 870300000000000XXXXXXXXXXXXXXX0000000000
<= 000000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000001f001f
140000000000000XXXXXXXXXXXXXXX0000000000
=> 8700000001860000
<= 870300000000000XXXXXXXXXXXXXXX0000000000
<= 000000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000270027
140000000000000XXXXXXXXXXXXXXX0000000000
=> 8b00000003890000
<= 8b0100000000000XXXXXXXXXXXXXXX0000000000
<= 050100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000002f002f
140000000000000XXXXXXXXXXXXXXX0000000000
=> 8300000003800001
<= 830100000000000XXXXXXXXXXXXXXX0000000000
<= 010100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000390039
140000000000000XXXXXXXXXXXXXXX0000000000
=> 8b00000003890000
<= 8b0100000000000XXXXXXXXXXXXXXX0000000000
<= 050100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000420042
140000000000000XXXXXXXXXXXXXXX0000000000
=> 8300000003800001
<= 830100000000000XXXXXXXXXXXXXXX0000000000
<= 010100000000000XXXXXXXXXXXXXXX0000000000
=> 8300000003800001
<= 830100000000000XXXXXXXXXXXXXXX0000000000
<= 010100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000510051
140000000000000XXXXXXXXXXXXXXX0000000000
=> 8300000003800001
<= 830100000000000XXXXXXXXXXXXXXX0000000000
<= 010100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000005b005b
140000000000000XXXXXXXXXXXXXXX0000000000
=> 0f2500000b040100
=> 0505019001900100000220032003000003400640
=> 06000004800c800c000005001900190000
<= 0f0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000006c006c
140000000000000XXXXXXXXXXXXXXX0000000000
=> 0b0600000b010100
=> 001900190000
<= 0b0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000007e007e
140000000000000XXXXXXXXXXXXXXX0000000000
=> 0f010000050b0100
=> 02
<= 0f0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000008b008b
140000000000000XXXXXXXXXXXXXXX0000000000
1501000010050100
54
150000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000009d009d
140000000000000XXXXXXXXXXXXXXX0000000000
0501000001040000
01
050000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000ab00ab
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010100010101
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000b400b4
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010200010102
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000c200c2
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010300010103
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010b00060101
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010c00060102
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010e00070104
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010900010109
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010a0001010a
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010400010104
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010500010105
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010101010101
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010201010102
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010301010103
0c0000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010b01060101
0c0000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010c01060102
0c0000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010e01070104
0c0000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010901010109
0c0000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010a0101010a
0c0000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010401010104
0c0000000000000XXXXXXXXXXXXXXX0000000000
0c06000008040100
010501010105
0c0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000cc00cc
140000000000000XXXXXXXXXXXXXXX0000000000
…
(Packet 3337)
8500000005850001
850100000000000XXXXXXXXXXXXXXX0000000000
000100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000630063
140000000000000XXXXXXXXXXXXXXX0000000000
8500000005810001
850100000000000XXXXXXXXXXXXXXX0000000000
ff0100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000590059
140000000000000XXXXXXXXXXXXXXX0000000000
9100000001900000
910100000000000XXXXXXXXXXXXXXX0000000000
000100000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000004f004f
140000000000000XXXXXXXXXXXXXXX0000000000
…
(Packet 4625)
1408000010040000
0400000000860086
140000000000000XXXXXXXXXXXXXXX0000000000
0f010000050b0100
00
0f0000000000000XXXXXXXXXXXXXXX0000000000
1501000010050100
00
150000000000000XXXXXXXXXXXXXXX0000000000
0f010000050b0100
00
0f0000000000000XXXXXXXXXXXXXXX0000000000
1501000010050100
00
150000000000000XXXXXXXXXXXXXXX0000000000
0f010000050b0100
02
0f0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000040004
140000000000000XXXXXXXXXXXXXXX0000000000
1501000010050100
54
150000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000000d000d
140000000000000XXXXXXXXXXXXXXX0000000000
0f010000050b0100
02
0f0000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
04000000001b001b
140000000000000XXXXXXXXXXXXXXX0000000000
1501000010050100
54
150000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000250025
140000000000000XXXXXXXXXXXXXXX0000000000
1408000010040000
0400000000330033
140000000000000XXXXXXXXXXXXXXX0000000000
…
=> 1408000010040000
=> 0400000000810081
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000770077
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 04000000006d006d
<= 140000000000000XXXXXXXXXXXXXXX0000000000
…
=> 1408000010040000
=> 0400000000000000
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000000000
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 1408000010040000
=> 0400000000000000
<= 140000000000000XXXXXXXXXXXXXXX0000000000
=> 9000000010800001
<= 900100000000000XXXXXXXXXXXXXXX0000000000
<= 040100000000000XXXXXXXXXXXXXXX0000000000
=> 9300000010830104
2B <= 0510000000000000
<= 930a00000000000XXXXXXXXXXXXXXX0000000000
<= 02002802ff00ff00ffffXXXXXXXXXX0000000000
=> 0f010000050b0100
2B <= 0510000000000000
=> 00
2B <= 0510000000000000
<= 0f00000000000002ffffXXXXXXXXXX0000000000
=> 130a000010030100
=> 02002802ff00ff00ffff
<= 1300000000000002ffffXXXXXXXXXX0000000000
=> 8300000001820000
<= 8302000000000002ffffXXXXXXXXXX0000000000
<= 0300000000000002ffffXXXXXXXXXX0000000000

In the extract just above, we can see the `13` command seemingly being split in two packets and used to define a lighting effect. (NB: Current effect on the mouse would be alternating two color pulses)
I can confirm that manually sending that command to the mouse actually does update the current effect.

We can dissect the command a bit:

13 0a 0000 10 03 01 00
CC LL      ?? ?? ?? ??
02 00 28 02 ff00ff 00ffff
AA       BB R1G1B1 R2G2B2

Either AA or BB would be the effect ID, as alternating two color pulses is effect `02`.

For the non bluetooth protocol, the set effect command is as so:
```
<Persist:U8> <Zero:U8> <Effect:U8> <Parameter0:U8> <Parameter1:U8> <ColorCount:U8> <Color0:RGB> <Color1:RGB>
```

So, we can assume that AA is the effect ID and BB is the color count.

In the non-bluetooth protocol, the set effect command would be `02` in category `0F`, but there does not seem to be an obvious mapping between the two protocols.
… Or … Maybe the command sent just before is used to define a command category? But that wouldn't actually make sense, as sending the command through Bluetooth LE Lab without any other preparation does actually work.

But actually, it seems that by going further back in the packets, we see the `93` command, which does seem to return the current effect…
So, maybe we don't have everything, but we could make things work?

It would seem that there is a similar pattern of commands with the MSB set being read commands, while commands with the MSB cleared would be write commands.

It seems that the color effect write command above was for persisted colors, so I would assume that the last four bytes of the initial packets are command parameters.
In that case, comparing to the non-bluetooth protocol, we were missing two bytes, so it would seem logical to assume that the last two bytes are actually those missing commands.
(It matches too)

But, what could be the two previous bytes ?

81 00 00 00 00 81 00 00 // FW maybe ?
83 00 00 00 01 82 00 00
83 00 00 00 01 83 00 00 // Read serial number
83 00 00 00 03 80 00 01
05 02 00 00 05 04 00 00
85 00 00 00 05 85 00 01
85 00 00 00 05 81 00 01 // Read battery level
87 00 00 00 01 86 00 00
0b 06 00 00 0b 01 00 00 // Set Mouse DPI
8b 00 00 00 03 89 00 00
0f 25 00 00 0b 04 01 00 // Set DPI values ?
0f 01 00 00 05 0b 01 00 // ??
91 00 00 00 01 90 00 00
13 0a 00 00 10 03 01 00 // Set (persisted) lighting effect
93 00 00 00 10 83 01 04 // Read (persisted) lighting effect
14 08 00 00 10 04 00 00 // Set live color
15 01 00 00 10 05 01 00 // Set brightness

CC LL 0000 xx yy P1 P2

The `14` command seems to be the dynamic color command, where the actual color is passed at the very end (of the second packet). Other parameters are unknown.
The `15` command seems to be the brightness, as the value passed is `0x54` which is about 33%. (84/255)
The `0f` command seems to be the one used to set DPI values and also other things, depending on unknown parameters.
The `0b` command seems to be used to define the current DPI using explicit values.

NB: It looks that byte `yy` is also correlated with reads or writes. We can see the MSB being correlated with the MSB of the command ID. 
⚠️ It seems that messing up the matching can make the device behave weird.
