
User shinyquagsire23 on GitHub did some interesting work on reverse engineering, and we can find some useful information here: https://github.com/rockowitz/ddcutil/issues/100

> ok actually I managed to find the input switching in a service manual of all things (filename 32BL95UW.pdf, search `lg monitor service manual "DDC2AB"`), but it's not via VCPs, it's via the service/factory/manufacturer sidechannel "DDC2AB" (0x50 instead of 0x51)
> 
> Over USB HID (VID 0x043E, PID 0x9a39):
> `08 02 55 04 26 00 0b 37 50 84 03 f4 00 90 dd`
> 
> Over I2C:
> `50 84 03 f4 00 90 dd`
> 
> So it's DDC2AB Command 0xF4, values 0x90 (HDMI1) 0xD0 (DP) 0xD2 (USB-C). It operates the same as the input switcher as well, so if you're in PBP and the secondary is HDMI1, it will swap the displays if you set the primary to HDMI1.

So, we should generally be looking for the raw DDC message format in 

More importantly, we have an example DDC packet wrapped in the HID protocol format, which will be of great help.

## Protocol traces and analysis

Upon starting OnScreen Display Software
IN =>
0c 00 29 01 80 1a 06 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT =>
0c 00 29 00 36 2e 3037 00 484944 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
             6  .  0 7     H I D
            NV NV NV NV

IN =>
08 01 29 03 05 00 03 37 51 82 01 c9 75 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>
08 02 29 04 0b 00 0b 37 51 82 01 c9 75 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT =>
0f 02 29 00 6e 88 02 00 c9 01 ff ff 04 06 7e 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
                                    SV SV

IN =>
08 03 29 03 07 00 03 37 50 84 03 c9 00 06 76 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>
08 04 29 04 09 00 0b 37 50 84 03 c9 00 06 76 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT =>
0d 04 29 00 86 44 00 56 80 41 1b 00 70 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
               DV


### Observed structure of a DDC request message

08 01 29 03 05 00 03 37518201c975
?? NN VV CC LL ?? XX DDC part

The NN part seems to be an incremental and overflowing counter. (We can see it overflow during software updates), probably used to match requests with responses.

The VV part seems to be a semi-randomly chosen value used throughout a session with the device. (This would supposedly allow multiple programs to access the device simultaneously.)

The CC part seems to be some kind of command information. 03 for a DDC request without response, and 04 for a DDC request with response ?
This is a bit cryptical, as the first byte also seems to be some kind of category or command. Although it is always 0x08 for DDC requests.

The LL part would be the DDC packet data length excepted the I2C address (0x37) when the command is 0x03, and the expected result length when the command is 0x04 ?

The XX part seems to be 0x03 when CC ix 0x03, and 0x0B when CC is 0x04

The DDC part of the message follows the standard DDC format, except that the I2C address is not shifted right (It usually would be 0x37 << 1 = 0x6E)
The signature seems to still consider the shifted value of the I2C address (0x6E, which is somewhat logical but weirdly inconsistent).

### Observed structure of a DDC response message

0f 02 29 00 6e880200c901ffff04067e
SS NN VV    DDC part

In the DDC response, the destination address field is missing, but the source address has the standard value of 0x6E.

The SS part seems to always be the total data length, including the byte itself. Still no idea as to what this value is supposed to be in the other direction.
E.g. We use 0C for the "handshake" that returns some info, and we get a response using 0C, which is exactly 12 bytes. But for the input, it was only 7 bytes.
For DDC messages, 8 bytes is the exact length of the header before the ddc data, so it could be that sometimes.


### Reading data from I2C

It seems a read after a command that doesn't return anything would often return a single byte of 0x10.
I'm assuming the I2C chip has some kind of internal buffer, as it will always fill the requested amount of bytes with either real data or garbage.
Said garbage very often including leftover data from previous reads, in a mostly consistent way.


### Error Response ?

04 00 00 11


2A NN SS => After invalid data has been sent ?


# RGB Control

## Protocol traces and analysis

Things happen on the second HID device interface.

````
tshark -r lg_usb_rgb.pcap -T fields -e usb.irp_info.direction -e usbhid.data "usb.data_len > 0"
````

Upon Starting LG UltraGear Control Center (RGB Lighting Disabled)

IN  => 5343c301020000d04544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c301060000000000af390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c301020000d04544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c301060000000000af390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c401020000d74544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c40106000000000001900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c501020000d64544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c50109240923091a091109089b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c601020000d54544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c601060000000000ff6c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c801020000db4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c801060000000000019c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000200010c0c980000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c801020000db4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c801060000000000019c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000200010c0c980000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343d100020000c34544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52d10006040700000607870000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Upon Starting LG UltraGear Control Center (Active Mode Dynamic Mode)

IN  => 5343c301020000d04544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c301060000000000af390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c301020000d04544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c301060000000000af390000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c401020000d74544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c40106000000000001900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c501020000d64544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c50109240923091a091109089b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c601020000d54544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c601060000000000ff6c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343c801020000db4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c801060000000000069b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 XXXX
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffffff6a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 XXXX
IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000100010c0c9b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 XXXX
IN  => 5343c801020000db4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c801060000000000069b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 XXXX
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffffff6a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 XXXX
IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000100010c0c9b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 XXXX
IN  => 5343d100020000c34544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52d10006040700000607870000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000


// 00000000000000000000000000000000000000000000000000000000

Upon setting the first static color (Default Red)

IN  => 5343c702020001d64544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c70206000000000000910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343ca02020301d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ca02060000000000009c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Upon setting the second static color (Default Fuchsia)

IN  => 5343c702020002d54544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c70206000000000000910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343ca02020302db4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ca02060000000000009c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Lighting off (from Static 1)

IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000100010c0c9b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cf02020200dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cf0206000000000000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Requesting Static Color 1 (Click "Modify") (Red)

IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Requesting Static Color 2 (Magenta/Fuchsia)

IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Requesting Static Color 3 (Cyan)

IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Requesting Static Color 4 (White)

IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Modifying Static Color 4 (White to Orange FF8000)

IN  => 5343d2020404ff8000bf454400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52d20206000000000000840000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffff80000411000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Enabling Peaceful Mode (From Off)

IN  => 5343c702020005d24544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c70206000000000000910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343ca02020305dc4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ca02060000000000009c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Disabling Peaceful Mode

IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000100010c0c9b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cf02020200dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cf0206000000000000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Enabling Dynamic Mode

IN  => 5343c702020006d14544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c70206000000000000910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343ca02020306df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ca02060000000000009c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Turning LEDs OFF (Active Mode Dynamic Mode)

IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000100010c0c9b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cf02020200dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cf0206000000000000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Turning LEDs ON (Active Mode Dynamic Mode)

IN  => 5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000200010c0c980000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN  => 5343cf02020100de4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cf0206000000000000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Audio Sync Mode

IN =>  5343c702020007d04544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c70206000000000000910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343ca02020307de4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ca02060000000000009c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c2026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd45440000000000000000000000
OUT => 52c20206000000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c2026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000bd45440000000000000000000000
OUT => 52c20206000000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c2026d00000000000000000000000000000000000000000000000000000000000000000000000000ff1300ff1300ff1300ff1300ff1300ff1300ff1300ff
IN =>  1300ff1300ff1300ff1300ff1300ff1300ff1300000000000000000000000000000000000000000000000000000000000000bd45440000000000000000000000
OUT => 52c20206000000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c2026d00000000000000000000000000000000000000000000000000000000000000000000000000000000ff1a00ff1a00ff1a00ff1a00ff1a00ff1a00ff
IN =>  1a00ff1a00ff1a00ff1a00ff1a00ff1a00ff1a000000000000000000000000000000000000000000000000000000000000005845440000000000000000000000
OUT => 52c20206000000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
… (Stopping)
IN =>  5343c2026d00000000000000000000000000000000ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff
IN =>  0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041ff0041000000000000000000000000000000bd45440000000000000000000000
OUT => 52c20206000000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c2026d00000000000000000000000000ff003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff
IN =>  003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff003bff003b0000000000000000000000000000007945440000000000000000000000
OUT => 52c20206000000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343cc01020000df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cc010e04ff0000ff00ff00ffffffffffff6a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c2026d00000000000000000000000000ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff
IN =>  0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034ff0034000000000000000000000000bd45440000000000000000000000
OUT => 52c20206000000000000940000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

Video Sync Mode

IN =>  5343c702020008df4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c70206000000000000910000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343ca02020308d14544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ca02060000000000009c0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000be45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d001f171830252639292037261f2019162c201d3b2c26402d2a3f2f2c4436344a4b4c432c12544f4d403c3b4843425756575855565553545555554c
IN =>  494a413d393a36364e49463e25124132283e2a1f3c290e3b270e58432e635141463d355041345a514a4e453d3e3433241b1b9545440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d002e2324483739563d3052392e30262142302b59423960443f5e46420000000080ff64421bff8000605a580000008000ffff0080ff0080ff8000ff
IN =>  0080615c55575151ff80005d371b614b3c5d3f2e5a3d15583b15ff8000ff8000000000ff8000ff8000ff80005d4e4c3628299a45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
… (Stopping)
IN =>  5343c1026d003c4361ff00808000ff8000ffff40000000000000004000ff8000ff4000ffff4000ff4000ffa000ff8000ff8000ff8000ffffffff8000ff8000ff
IN =>  a000ff80008000ffff00a0ff00804000ff000000000000000000000000612222000000ff2000ff00806243382a2f482d324ac045440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343ce01020000dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52ce0106000100010c0c9b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343cf02020200dd4544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cf0206000000000000990000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
IN =>  5343c1026d003c43648000ff8000ff8000ffff40004b2c420000000000008000ff4000ff5e475357475affa000ff0080ff8000ff8000ff8000ff0080ff8000ff
IN =>  8000ff8000ff0080ff0080000000000000000000000000000000000000000000000000ff0040ff0040000000282d452b3048cc45440000000000000000000000
OUT => 52c10206000000000000970000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

### Observed structure

It seems that requests always start with 0x5343xx and responses always start with 0x52xx where "xx" is the same number in request and response.
It does seem like xx is some kind of command ID, because while it appears weirdly increasing in some cases, some numbers are skipped, and some are duplicated.
The sequence "4544" is found in all request messages (at the end of the non-zero sequence) for some reason.

c7 Seems to be the command that enables the RGB lighting.
cc would likely be the command that request RGB lighting settings. (It at least retrieves the 4 static colors)

#### Analysing a request

This is an example of the request/response for RGB lighting settings.

5343 cc 01 02 00 00 df 4544 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
"SC" CC aa bb       KK "ED"
52 cc 01 0e 04 ff0000 ff00ff 00ffff ffffff 01 94 000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
R  CC aa LL NN R1G1B1 R2G2B2 R3G3B3 R4G4B4 II KK

CC is assumed to be a command ID.
II Seems to indicate which static color is active (1 2 3 or 4 here), or FF if no static color is active
RnGnBn Are the RGB components for color N
NN might be the number of static colors (Because there are 4 and the value here is 4… Could be something else also)
aa & bb are only ever observed to take the values "01 02" and "02 02"
KK Seems to take different values depending on the mode the screen is in. (Could be a checksum ? If so, it will be easy to verify)
   94 => When all colors are left at their default and the static color 1 is selected.
   11 => When the 4th color was modified to orange and on
   97 => When the second color is on
   6a => When the lighting was set to dynamic
   96 => When the third color is on
   91 => When the fourth color is on
LL Seems to be the length of the response data. (Total length minus 4 to account for header and trailer bytes)

e.g. for the status with 4 static lighting modes:
52cc010e04ff0000ff00ff00ffffffffff0194000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
52cc010e04ff0000ff00ff00ffffffffff0297000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
52cc010e04ff0000ff00ff00ffffffffff0396000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
52cc010e04ff0000ff00ff00ffffffffff0491000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
e.g. for dynamic mode
52cc010e04ff0000ff00ff00ffffffffffff6a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

The numbers above seem to correlate the fact that the value is a XOR checksum:

The only part that are changing in the above 4 static lighting messages are "0194", "0297", "0396", "0491"
Going from 01 to 02 is XOR 03 => going from 94 to 97 is XOR 03
Going from 01 to 03 is XOR 02 => going from 94 to 96 is XOR 02
Going from 01 to 04 is XOR 05 => going from 94 to 91 is XOR 05
And we can confirm that 95 XOR FF => 6A (95 being the supposed value if II is 00: 94 XOR 1 = 95)

Now, we could even be able to compute which parts of the message are accounted for…
The only byte having bit 7 set is the second byte of the response message, so it is easy to assume that in that case, the checksum applies to the whole message (except the checksum itself)
Indeed, if computed on the sequence "52cc010e04ff0000ff00ff00ffffffffffff", we get "6A". This checks out.

This seems to apply to (all?) other messages too.
e.g.
52cb01060000000000049 => A0
From
IN  => 5343cb01020000d84544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52cb01060000000000049a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

So we can conclude that all messages are ended with a XOR checksum of all the bytes in the message.

Knowing this, we can determine (and verify) that the byte preceding 4544 is also a XOR checksum for request messages. (But what is 4544 ?)

In fact, it seems that the LL byte in responses indicate the length of the actual response, excluding the header and the trailer (checksum).

aa seems to be a sub-command kind of thing. It is always 01 when requesting information from the device, and seems to be 02 when requesting a change from the device.

Similarly, bb should be the length of the message data for requests, as we can see in the command to set static color 4 to FF8000:
5343 d2 02 04 04 ff8000 bf 4544 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
"SC" CC DD LL NN RRGGBB KK "ED"

A possible explanation for the 4544 sequence, is that it is used to explicitly identify the end of a message, in the case of fragmented messages (video sync mode)
The pattern would always be [checksum of the previous bytes] 45 44, so it could be used that way. (Doesn't seem necessary, though. It might be something else)

=> In fact, the `4544` is `ED` in ASCII which simply means "END", while `5343` is `SC` which would be "Start Command".
Similarly, responses start with `R`. They do lack an end marker, though.

As we can see in audio/video messages containing 109 bytes, there are 36 colors mapping to 36 LEDs. If we look for the value `24` above (36 in hex), we find that value returned by the command `C5`.
Since this is a read command (direction `01`), it could match:

IN  => 5343c501020000d64544000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
OUT => 52c50109240923091a091109089b0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000

52 c5 01 09 240923091a09110908 9b
R  CC DD LL NN                 KK

NN would be the LED count.
Other values are 9, 35, 9, 26, 9, 17, 9, 8.
We see the 9 repeated everytime afterwards, so either it has a separate meaning that is weirdly repeated, or it is a 16-bit value.
If we interpret the data as 16-bit: 2339, 2330, 2321, 2312. This seems relatively meaningless.

### Structure of messages

All messages are emitted in 64 byte packets. The remaining bytes in the packet are always zero.

#### Request messages

`53 43 <Command> <Direction> <Length> <Message Data…> <Checksum> 45 44`

Input messages can be fragmented in multiple packets. The total length is based on the Length specified in the first packet.
Assuming a length of 255, the total length would be 255+8, because of the header and trailer.

#### Response messages

`52 <Command> <Direction> <Length> <Message Data…> <Checksum>`

Response messages follow a similar format to request messages, with less header and trailer bytes.

Each request generates a corresponding response.

The command and direction bytes exactly match the request.

### Observed command IDs

C1 Dynamic colors (Video Sync Mode)
C2 Dynamic colors (Audio Sync Mode)
C3 
C4 
C5 Get LED Information
C6 
C7 Set Lighting Mode
C8 
CA Enable Lighting Mode ?
CB 
CC Get Static Lighting Info
CE 
CF Enable/Disable Lighting
D1 
D2 Set Static color

#### Update Video Dynamic Colors

This is basically, the addressable mode. When this mode is entered, the monitor will display a dialog if the user tries to manually change the color preset.

Command: `C1`

Direction: `02`

Request data: `00 <RRGGBB …>`

Response data: `00 00 00 00 00 00`

`RRGGBB` Are 24-bit RGB color data. This is repeated once for each addressable LED.

Messages are of length 109, including the first zero-byte.
It is possible that this first byte, always set to zero in the observed data, is actually an offset (either byte offset or LED index) to allow updating only a subset of LEDs in combination with the length.
This will be easy to verify later.

#### Update Audio Dynamic Colors

This seems perfectly similar to command `C1` used for video. It seems all the processing is done in software.
I'm not sure what I could be missing here.

Command: `C2`

Direction: `02`

Request data: `00 <RRGGBB …>`

Response data: `00 00 00 00 00 00`

`RRGGBB` Are 24-bit RGB color data. This is repeated once for each addressable LED.

#### Request RGB lighting settings

Command: `CC`

Direction: `01`

Request data: `00 00`

Response data: `NN <RRGGBB …> II`

`NN` Is the number of predefined static colors.
`RRGGBB` Are 24-bit RGB color data. This is repeated once for each predefined static color.
`II` Is the 1-based active static color index. Or 0xFF if not applicable.

#### Set Static Color

Command: `D2`

Direction: `02`

Request data: `II RRGGBB`

Response data: `00 00 00 00 00 00`

`II` Is the 1-based active static color index for which the color must be defined.
`RRGGBB` Is 24-bit RGB color data.

#### Set Lighting Mode

Command: `C7`

Direction: `02`

Request data: `00 II`

Response data: `00 00 00 00 00 00`

`II` Is the preset index

* 01 Static Color 1
* 02 Static Color 2
* 03 Static Color 3
* 04 Static Color 4
* 05 Peaceful
* 06 Dynamic
* 07 Audio Sync
* 08 Video Sync

#### Enable Lighting Mode ?

This command is used after command `C7` when an effect is enabled. It supposedly enables the lighting after it has been disabled (e.g. with command CF), but it seems a bit weird.

Changing effects with `C7` only works, but when the LEDs are off, they stay off. LG Software sends this command after an effect is enabled without prior knowledge of LED lighting status.

Command: `CA`

Direction: `02`

Request data: `03 II`

Response data: `00 00 00 00 00 00`

`II` Is the preset index

#### Enable/Disable Lighting

Command: `CF`

Direction: `02`

Request data: `MM 00`

Response data: `00 00 00 00 00 00`

`MM` Is `01` to enable and `02` to disable.

#### Get LED Information

Command: `C5`

Direction: `01`

Request data: `00 00`

Response data: `NN __ __ __ __ __ __ __ __`

`NN` Is the number of LEDs
